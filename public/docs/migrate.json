c({"name": "migrate", "type": "page", "comment": "<p>There are many new feature in JavaScriptMVC 3.2 that help you build great JavaScript applications.\nAlthough 3.2 is not strictly backwards compatible it is possible to upgrade from\nand earlier version. This guide outlines the things you have to look at when upgrading from\nversion 3.0 or 3.1.</p>\n\n<h2>Steal</h2>\n\n<p>[stealjs | Steal] has experienced a major improvement, making it even easier to manage your dependencies.\nInstead of defining what you want to steal like <em>steal.plugins</em>, <em>steal.controllers</em> or <em>steal.views</em> you\njust steal the file and Steal will figure out what to do with it based on the extension.\nSo if your code used to look like this:</p>\n\n<pre><code>steal('helper').plugins('jquery/controller', 'jquery/view/ejs', 'jquery/controller/view').views('init.ejs')\n    .css('style').then(function($) {\n    $.Controller('Test.Controller', {}, {\n        init : function(el, ops)\n        {\n            this.element.html(this.view());\n        }\n    });\n});\n</code></pre>\n\n<p>The new Steal looks like this:</p>\n\n<pre><code>steal('./helper.js', 'jquery/controller', 'jquery/view/ejs', './views/init.ejs', './style.css', function($) {\n    $.Controller('Test.Controller', {}, {\n        init : function(el, ops)\n        {\n            this.element.html(this.view());\n        }\n    });\n});\n</code></pre>\n\n<p>The rules when stealing a file:</p>\n\n<ul>\n<li>./ refers to the path of the current file</li>\n<li>When stealing something without extension like <em>jquery/controller</em> Steal will first look for the plugin\nfile <em>jquery/controller/controller.js</em> and if not found <em>jquery/controller.js</em> based on your applications\nroot path</li>\n<li>./helper.js loads helper.js in the folder of the current file</li>\n<li>./views/init.ejs loads the init.ejs [jQuery.EJS | EJS view] from views subfolder in the current folder</li>\n<li>./style.css loads the style.css file in the current folder</li>\n</ul>\n\n<p>Note that the new Steal runs asynchronously so you might have to be more careful using <em>steal.then()</em>\nif there are dependencies that have to be loaded before another. This is also important when putting code\noutside of steal. Because jQuery hasn't been loaded you can not use the jQuery object. So instead of\n$(document).ready use this:</p>\n\n<pre><code>steal.then(function() {\n    $('body').my_plugin();\n});\n</code></pre>\n\n<h2>Organizing your application</h2>\n\n<p>Starting with version 3.1 and fully encouraged in 3.2 JavaScriptMVC follows a new approach in organizing your application structure.\nRead the complete guide on [organizing | organizing your app] to get an idea. For migrating from the old structure\nthe following things are important:</p>\n\n<ul>\n<li>The use of the <em>controllers</em> folder is discouraged. You still can use it but organizing each controller in\ntheir own folder with a views subfolder is the preferred way as it is a lot more obvious how your application\nis split up and easier to test.</li>\n<li>Models reside in their own folder as they might be application wide and not controller specific\n(e.g. a recipe model will be used in a recipe_edit and a recipe_list controller)</li>\n</ul>\n\n<h2>Document controllers</h2>\n\n<p>There are no document controllers in 3.2 anymore (controllers that used have the default option <em>{ onDocument : true }</em>).\nInstead initialize your controllers like any [jquery.controller.plugin | jQuery plugin] in the application file.\nFor document wide controllers initialize them on the document itself. \nAn example how your main application file may look like:</p>\n\n<pre><code>steal('my/controller', 'my/global/controller', function($) {\n    $(document).ready(function($) {\n        $(document).global_controller();\n        $('.thing').my_controlller();\n    });\n});\n</code></pre>\n\n<p>Note that unlike the old document controllers a global controller will not listen to a specific id.</p>\n\n<h2>Listening to model changes</h2>\n\n<p>The notifications via OpenAJAX have been dropped in favor of the [jQuery.Observe Observable] mechanism.\nCheck out the documentation on [jquery.model.events | Model events] for detailed information on how use it for Models. </p>\n\n<h2>Controller History</h2>\n\n<p>Controller history using OpenAjax has been removed in 3.2. Use [jQuery.route] for full history and routing support.</p>\n\n<h2>Wrap Removed</h2>\n\n<p>The AJAX response converter 'wrap' and 'wrapMany' have been removed in favor of a [native jQuery converter http://api.jquery.com/extending-ajax/#Converters].</p>\n\n<p>Before, you would do a <em>this.callback</em> on the success like:</p>\n\n<pre><code>findAll : function(params, success, error ){\n    return $.ajax({\n        url: '/services/recipes.json',\n        type: 'get',\n        data: params\n        dataType : 'json',\n        success: this.callback(['wrapMany',success])\n    });\n}\n</code></pre>\n\n<p>now becomes:</p>\n\n<pre><code>findAll : function(params, success, error ){\n    return $.ajax({\n        url: '/services/recipes.json',\n        type: 'get',\n        data: params\n        dataType : 'json recipe.models',\n        success: success\n        });\n    }\n</code></pre>\n\n<h2>Callback Renamed to Proxy</h2>\n\n<p>The <em>this.callback</em> method has been deprecated and the preferred method is now <em>this.proxy</em>.</p>\n\n<h2>steal.browser.rhino removed</h2>\n\n<p>The <em>steal.browser.rhino</em> has been removed. We are using <em>steal.browsers</em> namespace for the browser drivers.  If you were using this to have rhino skip files in the build process, you can now use: <em>steal.isRhino</em>.</p>\n\n<h2>Associations</h2>\n\n<p>Associations were removed in favor of [jQuery.Model.static.attributes].  Attribute type values can also represent the name of a function which is used is for associated data now.</p>\n\n<h2>Upgrade Process and Advice</h2>\n\n<p>The changes listed above require significant adaptation of your code base.</p>\n\n<p>1) The word 'controllers' is no longer good for JMVC. If you have controllers in a directory of that name, change the name to something else. JMVC has new, automatic behavior that will break your system if you don't. </p>\n\n<p>Controller names must also be changed to the new directory name. Eg,</p>\n\n<pre><code>jQuery.Controller.extend('Appname.Controllers.Controllername')\n</code></pre>\n\n<p>becomes</p>\n\n<pre><code>jQuery.Controller.extend('Appname.NewName.Controllername')\n</code></pre>\n\n<p>and, the instantiation,</p>\n\n<pre><code>appname_controllers_controllername()\n</code></pre>\n\n<p>becomes</p>\n\n<pre><code>appname_newname_controllername()\n</code></pre>\n\n<p>2) The suffix \"_controller\" is no longer valid. Remove it from your controller names.</p>\n\n<p>3) Steal() has changed completely. It no longer has specific methods for different kinds of files. Eg,</p>\n\n<pre><code>steal.plugins(\n        'jquery/controller',\n        'jquery/controller/view'\n)\n</code></pre>\n\n<p>Becomes</p>\n\n<pre><code>steal(\n        'jquery/controller',\n        'jquery/controller/view'\n)\n</code></pre>\n\n<p>As do all the rest of the type-specific loaders: .resources(), .models(), .controllers(), .views() &amp; .css()</p>\n\n<p>4) The base directory steal() looks in has changed. Instead of referring to the directory containing the steal() build file, it refers to the directory containing the <em>call</em>, ie, if you have </p>\n\n<pre><code>foo/index.html containing &lt;script src='steal/steal.js?appName'&gt;\n</code></pre>\n\n<p>Steal() will find your build file:</p>\n\n<pre><code>foo/appName/appName.js\n</code></pre>\n\n<p>Previously, an unqualified reference, eg,</p>\n\n<pre><code>steal.resource('someJqueryPlugin');\n</code></pre>\n\n<p>would find </p>\n\n<pre><code>foo/appName/someJqueryPlugin.js\n</code></pre>\n\n<p>now you must use:</p>\n\n<pre><code>steal('appName/someJqueryPlugin.js');\n</code></pre>\n\n<p>Where appName/ is in the same directory as index.html.</p>\n\n<p>Note that both the application directory and extension are now necessary for most files (except controllers which refer to a directory structure).</p>\n\n<p>5) Steal() no longer makes assumptions about your directory structure. It no longer assumes, for example, a 'models' directory. File paths must, therefore be fully specified. </p>\n\n<p>Instead of </p>\n\n<pre><code>steal.models( 'session');\n</code></pre>\n\n<p>Use</p>\n\n<pre><code>steal('appDir/models/session');\n</code></pre>\n\n<p>5) Steal() now defaults to asynchronous loading. You must insure that your dependencies are loaded in the correct order using steal.then().</p>\n\n<p>If you have nested controller directories, eg</p>\n\n<p>parentController/\n--------parentController.js\n--------subordinateController/\n----------------subordinateController.js\n----------------views/\n------------------------subordinateController.ejs\n--------views\n----------------parentController.ejs</p>\n\n<p>Make sure that you have them in the correct order</p>\n\n<p>steal('parentController')\n.then('subordinateController')</p>\n\n<p>If they are* reversed*, the creation of parentController will overwrite the pre-existing directory containing subordinateController.</p>\n\n<p>(Note also, different from other components, controllers are <em>not</em> called as files. They are referred by their directory and assumed to have a javascript file of the same name inside.)</p>\n\n<p>It is also possible for controllers to be instantiated and views executed before loading is finished. CSS files must be appropriately sequenced, too.</p>\n\n<p>6) Initialization of the system has changed. The \"unload\" controller is no longer valid and does not run. $.ready() might run before components are all loaded.</p>\n\n<p>Remove \"onDocument: true\". Change the controller method load() to init() (ie, make it like other controllers).</p>\n\n<p>Add an instantiation of the initial controller to steal(). (Steal() now allows the final parameter of any of its methods to be a function.) Eg,</p>\n\n<p>steal(\n    'appName/initializingController'\n)\n.then(\n    'appName/someOtherController',\n    function(){\n        appName_initializingController(); //run initializing controller\n        //any $.ready() code goes here, too\n    }\n);</p>\n\n<p>7) With asynchronous loading, it is possible for dom elements to be queued but not rendered by the time they are needed by system code. For example, it is possible to get wrong values from jquery, for DOM elements that have been sent to the browser by code but not yet written to the DOM. It may be necessary to wrap initializing code in a timeout() of tenth of a second or so.</p>\n\n<p>8) this.publish() no longer works in models.</p>\n\n<p>You must now use:</p>\n\n<pre><code>$([this]).trigger(eventName, data); //where this is the model with the call\n</code></pre>\n\n<p>To receive the event in a controller, the old syntax no longer works.</p>\n\n<p>Instead of</p>\n\n<pre><code>'modelName.eventName subscribe':function(eventName, data){}\n</code></pre>\n\n<p>use</p>\n\n<pre><code>'{appName.models.modelName} eventName': function(sourceObject, eventObject, data){}\n</code></pre>\n\n<p>Note that the parameters to the receiving function have changed completely.</p>\n\n<p>9) In views rendered with EJS, the output delimiter:</p>\n\n<pre><code>&lt;%=varName%&gt;\n</code></pre>\n\n<p>now produces html that is escaped.</p>\n\n<p>When this is undesirable (eg, when the variable contains html), you must use:</p>\n\n<pre><code>&lt;%==varName%&gt;\n</code></pre>\n\n<p>To send the variable data unchanged.</p>\n\n<p>10) formParams() now produces an array for radio buttons. You must add </p>\n\n<pre><code>radioVarName=this.element.formParams().radioVarName.pop();\n</code></pre>\n\n<p>To extract a scalar value.</p>\n\n<p>11) formParams() no longer evaluates form values by default. Boolean variables containing the value 'true' or 'false' are not x===true or x===false, they are typeof(x)=='string'. Similarly with numbers. To return to the previous behavior, you must change the call to formParams(true). This will tell the method to evaluate parameters.</p>", "title": "Upgrading to 3.2", "parents": ["tutorials"], "order": 10, "src": "tutorials/migrate.md", "children": []})