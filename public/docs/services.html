<!DOCTYPE html>

<!--[if lt IE 7]>
<html class="no-js ie lt-ie9 lt-ie8 lt-ie7" lang="en">
<![endif]-->
<!--[if IE 7]>
<html class="no-js ie lt-ie9 lt-ie8" lang="en">
<![endif]-->
<!--[if IE 8]>
<html class="no-js ie lt-ie9" lang="en">
<![endif]-->
<!--[if IE 9]>
<html class="no-js ie ie9" lang="en">
<![endif]-->
<!--[if gt IE 9]><!-->
<html class="no-js" lang="en">
<!--<![endif]-->
<head>
	<meta charset="utf-8">
	<title>JavaScriptMVC - Ajax Service Guidelines </title>
	<meta name="description" content="">
	<meta name="author" content="">

	<link rel="stylesheet" type="text/css" 
		
			href="./static/production.css"
		 />
	<!--[if lt IE 9]>
   <script type="text/javascript" src="./static/html5shiv.js"></script>
    <!--<![endif]-->
</head>

<body class="docs">
	<header>
		<nav class="container">

			<div class="logo-menu">
				<a class="brand" href="./index.html">JavaScriptMVC</a>
			</div>

			<div class="pull-right">
				<div class="bitovi-menu">
					<a href="http://bitovi.com" class="bitovi icon-bits">Bitovi</a>
					<ul class="dropdown-menu">
						<li><a href="http://bitovi.com">Bitovi.com</a></li>
						<li><a href="http://bitovi.com/blog/">Blog</a></li>
						<li><a href="http://bitovi.com/consulting/">Consulting</a></li>
						<li><a href="http://bitovi.com/training/">Training</a></li>
						<li><a href="http://bitovi.com/open-source/">Open Source</a></li>
						<li><a href="http://bitovi.com/people/">People</a></li>
						<li><a href="http://bitovi.com/contact/">Contact Us</a></li>
					</ul>
				</div>
			</div>
		</nav>
	</header>

	<div class="container api">
	<nav class="sidebar">
		
		<div class="search-wrapper">
			<div class="search">
				<input type="text"/>
			</div>
		</div>
		
		<ul class="api cascading primary-grouping"> 
	
		
		<li class="search-container active parent">
			<a href="index.html" data-search="JavaScriptMVC">
				JavaScriptMVC
			</a>
		</li>
		
		
			<li class="search-container active">
			<a href="tutorials.html" data-search="Tutorials">
				Tutorials
			</a>
			
	<ul>
		
			
				
				
				<li class="search-container">
					<a class="page" href="installing.html" data-search="Installing JavaScriptMVC">
						Installing JavaScriptMVC
					</a>
				</li>
				
			
			
		
			
				
				
				<li class="search-container">
					<a class="page" href="rapidstart.html" data-search="Rapid Start">
						Rapid Start
					</a>
				</li>
				
			
			
		
			
				
				
				<li class="search-container">
					<a class="page" href="getstarted.html" data-search="Get Started with JMVC">
						Get Started with JMVC
					</a>
				</li>
				
			
			
		
			
				
				
				<li class="search-container">
					<a class="page" href="mvc.html" data-search="Get Started with CanJS">
						Get Started with CanJS
					</a>
				</li>
				
			
			
		
			
				
				
				<li class="search-container">
					<a class="page" href="tutorials.jquerypp.html" data-search="Get Started with jQuery++">
						Get Started with jQuery++
					</a>
				</li>
				
			
			
		
			
				
				
				<li class="search-container">
					<a class="page" href="funcunit.getstarted.html" data-search="Get Started with FuncUnit">
						Get Started with FuncUnit
					</a>
				</li>
				
			
			
		
			
				
				
				<li class="search-container">
					<a class="page" href="organizing.html" data-search="Organizing Your App">
						Organizing Your App
					</a>
				</li>
				
			
			
		
			
				
				
				<li class="search-container">
					<a class="page" href="ajaxy.html" data-search="Searchable Ajax Apps">
						Searchable Ajax Apps
					</a>
				</li>
				
			
			
		
			
				
				
				<li class="search-container active">
					<a class="page" href="services.html" data-search="Ajax Service Guidelines">
						Ajax Service Guidelines
					</a>
				</li>
				
			
			
		
			
				
				
				<li class="search-container">
					<a class="page" href="done.html" data-search="Upgrading to 3.3">
						Upgrading to 3.3
					</a>
				</li>
				
			
			
		
	</ul>


		</li>
		
	
</ul>

	</nav>
	<article class="content docs">
		<section class="title">
			<div class="pull-right">
	<ul class="tags">
		<li>page</li>
	</ul>
	<ul class="links">
		
			<li><a href="">source</a></li>
		
		
			
		
		
	</ul>
</div>

<h1>
Ajax Service Guidelines

	
		<span class="module">services</span>
	


</h1>

<span class="inherits">&nbsp;</span>

		</section>

		<section class="contents">
		</section>

		<section class="description">
			
		</section>

		

		

		
		<section class="comment">
			<p>JavaScriptMVC's flexibility allows it to 
be used with almost any service layer.  However, 
this guide details suggests a service layer design 
that minimizes the amount of extra work to get JavaScriptMVC running.</p>

<p>In general, the service layer should be as 
thin as possible and reflect the Database 
queries and results the server must make 
to get the data.  This keeps things flexible 
from the client's perspective.</p>

<h2>JSON Rest Part 1</h2>

<p>The best over-all service layer can be described as JSON REST.  </p>

<p>JSON is used as the data received and sometimes sent to the server.</p>

<p><a href="http://en.wikipedia.org/wiki/Representational_state_transfer Representational State Transfer">REST</a> is 
where there are resource urls that are 
modified with <code>GET POST PUT</code> and <code>DELETE</code> methods.  </p>

<p>A brief example is a service API for messages.  The server might expose the 
following METHOD and URLS:</p>

<p><code>GET /messages        </code> - gets an array of messages from the server.
<code>GET /messages/{id}   </code> - gets a single message from the server.
<code>POST /messages       </code> - creates a message from the server.
<code>PUT /messages/{id}   </code> - updates a message from the server.
<code>DELETE /messages/{id}</code> - destroys a message from the server.</p>

<h2>Query String Params</h2>

<p>Before going into detail about what each 
<code>METHOD URL</code> does, it's worth 
quickly describing how parameters are 
passed to the query string.  <a href="can.Model.html">can.Model</a> passes 
parameters to your framework of choices ajax handler
and that gets converted by <a href="can.param.html">can.param</a>. 
For example, if we wanted
all messages for a given user, 
sorted first by date, then by the users's name, 
we might call something like:</p>

<pre><code>$.get('/messages',{
  userId: 5, 
  order: ['createdAt ASC','user.name ASC'] 
})
</code></pre>

<p>Which produces:</p>

<pre><code class="lang-text">GET /messages?
        userId=5&
        order%5B%5D=createdAt+ASC&
        order%5B%5D=user.name+ASC</code></pre>

<p>Lets walk through each REST service example.</p>

<h2>GET /messages</h2>

<p>A request to GET /messages should return 
all message records visible to the 
requesting user.  The data should look like:</p>

<pre><code>{
  "data": [
      {
         "id" : 1,
         "fromUserId": 921,
         "text": "Hello World",
         "createdAt" : 1024324214123
      },
      {
         "id" : 2,
         "fromUserId": 923,
         "text": "Goodnight World",
         "createdAt" : 23524365346543
      },
      ...
  ],
  "count": 100 
}
</code></pre>

<p>Where:</p>

<ul>
<li><code>data</code> - has an array of objects (in this case 100), 
each object contains the data for a single message.</li>
<li><code>count</code> - lists the number of items that 
would be returned if a limit was not used.  In this 
case, no limit was used so count matches the number of items.</li>
</ul>

<p><code>GET /messages</code> will typically take 
arguments passed in as name=value parameters 
in the query string like:</p>

<blockquote>
  <p><code>GET /messages?limit=10&amp;offset=20&amp;order[]=createdAt+DESC</code></p>
</blockquote>

<p>Common name / values are:</p>

<ul>
<li><code>limit</code> - the total number of items to return</li>
<li><code>offset</code> - the position in the 'total' set to start returning items</li>
<li><code>order</code> - an array of 'NAME SORTORDER' pairs</li>
</ul>

<p>You'll notice that these properties can effectively be sent straight away to a DB query.</p>

<h4>Relationships</h4>

<p>Often, you want to get all data for a particular item.  For example, 
all messages from user 52.  Instead of requesting something like:</p>

<blockquote>
  <p><code>GET /users/52/messages</code></p>
</blockquote>

<p>A request should be made to:</p>

<blockquote>
  <p><code>GET /messages?fromUserId=52</code></p>
</blockquote>

<p>The service should limit messages to only those where <code>fromUserId = 52</code>.</p>

<h3>Related Data</h3>

<p>Another common problem is when, for 
performance reasons, you want the 'joined' 
data for a particular field.  For example, 
when getting messages, you might want to also 
want to get the user data from fromUserId.  </p>

<p>In this case, we encourage the use 
of an 'include' option which 
signifies including additional data like:</p>

<blockquote>
  <p><code>GET /messages?include[]=fromUser</code></p>
</blockquote>

<p>The fromUser data will be added to each message object like:</p>

<pre><code>{
  "data": [
      {
         "id" : 1,
         "fromUserId": 921,
         "text": "Hello World",
         "createdAt" : 1024324214123,
         "fromUser": {
           "id" : 921,
           "name" : "Justin Meyer"
         }
      },
      ...
  ],
  "count": 100 
}
</code></pre>

<h2>GET /messages/{id}</h2>

<p>Gets a single item from the server.  It should return just the JSON data for the object like:</p>

<pre><code>-&gt;{
    "id" : 1,
    "fromUserId": 921,
    "text": "Hello World",
    "createdAt" : 1024324214123
}
</code></pre>

<h2>POST /messages</h2>

<p>Creates a message on the server.  Typically, 
the body of this request is JSON data that 
looks exactly like the data from a GET request, 
but without the id property or any properties 
the server might add.  For example, I can 
create a message by sending:</p>

<pre><code>POST /messages
{
    "fromUserId": 921,
    "text": "A new message"
}
</code></pre>

<p>The server is going to add the id and createdAt property and should return those as JSON in the response:</p>

<pre><code>-&gt;{
    "id": 22,
    "createdAt": 1224324214123
}
</code></pre>

<h2>PUT /messages/{id}</h2>

<p>This updates a resource.  Similar to POST, 
the body should be JSON that matches what 
the data from a GET request looks 
like.  However, only fields that are changing 
are necessary to send.  For example, we we 
want to update the text of a message:</p>

<pre><code>PUT /messages/22
{
  'text': "An updated EVIL message"
}  
</code></pre>

<p>The response should have any fields that were 
modified or adjusted on the server.  For 
example, the server might filter the word 
"EVIL" out of messages and be updating some 
'updatedAt' property.  It should return:</p>

<pre><code>-&gt;{
  'text' : "An updated message",
  'updatedAt' : 123254356346241
}
</code></pre>

<p>If no filtering or modifying of other changes 
happened, the server can just return 
an empty object: <code>{}</code>.</p>

<h2>DELETE /messages/{id}</h2>

<p>Destroys a resource from the server.  </p>

<h2>Sending Dates</h2>

<p>The best way of sending dates is an integer representing the Julian date like:</p>

<pre><code>createdAt: 12313123133423
</code></pre>

<p>Where we can convert that easily to a JavaScript date like</p>

<pre><code>new Date(123123133423)
</code></pre>

<h2>CUD Multiple Items with a Single Request</h2>

<p>Often, you want to create, update, or delete items with a single request.  This is
most often done with <a href="can.Model.List.html">can.Model.List</a>.</p>

<h2>Handling Errors</h2>

<p>When an error happens, make sure your server sends back the 
proper HTTP status code.  The response body should be a JSON object with
property names mapped to an array of errors:</p>

<pre><code>{
   email : ["Formatting is incorrect","No email is provided"]
}
</code></pre>
		</section>
		

		
	</article>
</div>



	<footer>
		<nav class="container">
			<a class="brand javascriptmvc" href="index.html"></a>
		</nav>
	</footer>
	<script type="text/javascript">
		window.Bitovi = {
			URL: {
				BUILDER: '',
				BUILDER_DATA: '',
				BITHUB: '',
				CDN: ''
			}
		}
		steal = {
			productionId: "production.js",
			executed: ["documentjs/site/static/build/production.css"]
		}
	</script>
	<script type='text/javascript' 
	
		src="./static/steal.production.js"
	
		></script>
</body>

</html>
