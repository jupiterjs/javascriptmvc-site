<!DOCTYPE html>

<!--[if lt IE 7]>
<html class="no-js ie lt-ie9 lt-ie8 lt-ie7" lang="en">
<![endif]-->
<!--[if IE 7]>
<html class="no-js ie lt-ie9 lt-ie8" lang="en">
<![endif]-->
<!--[if IE 8]>
<html class="no-js ie lt-ie9" lang="en">
<![endif]-->
<!--[if IE 9]>
<html class="no-js ie ie9" lang="en">
<![endif]-->
<!--[if gt IE 9]><!-->
<html class="no-js" lang="en">
<!--<![endif]-->
<head>
	<meta charset="utf-8">
	<title>JavaScriptMVC - Organizing Your App </title>
	<meta name="description" content="">
	<meta name="author" content="">

	<link rel="stylesheet" type="text/css" 
		
			href="./static/production.css"
		 />
	<!--[if lt IE 9]>
   <script type="text/javascript" src="./static/html5shiv.js"></script>
    <!--<![endif]-->
</head>

<body class="docs">
	<header>
		<nav class="container">

			<div class="logo-menu">
				<a class="brand" href="./index.html">JavaScriptMVC</a>
			</div>

			<div class="pull-right">
				<div class="bitovi-menu">
					<a href="http://bitovi.com" class="bitovi icon-bits">Bitovi</a>
					<ul class="dropdown-menu">
						<li><a href="http://bitovi.com">Bitovi.com</a></li>
						<li><a href="http://bitovi.com/blog/">Blog</a></li>
						<li><a href="http://bitovi.com/consulting/">Consulting</a></li>
						<li><a href="http://bitovi.com/training/">Training</a></li>
						<li><a href="http://bitovi.com/open-source/">Open Source</a></li>
						<li><a href="http://bitovi.com/people/">People</a></li>
						<li><a href="http://bitovi.com/contact/">Contact Us</a></li>
					</ul>
				</div>
			</div>
		</nav>
	</header>

	<div class="container api">
	<nav class="sidebar">
		
		<div class="search-wrapper">
			<div class="search">
				<input type="text"/>
			</div>
		</div>
		
		<ul class="api cascading primary-grouping"> 
	
		
		<li class="search-container active parent">
			<a href="index.html" data-search="JavaScriptMVC">
				JavaScriptMVC
			</a>
		</li>
		
		
			<li class="search-container active">
			<a href="tutorials.html" data-search="Tutorials">
				Tutorials
			</a>
			
	<ul>
		
			
				
				
				<li class="search-container">
					<a class="page" href="installing.html" data-search="Installing JavaScriptMVC">
						Installing JavaScriptMVC
					</a>
				</li>
				
			
			
		
			
				
				
				<li class="search-container">
					<a class="page" href="rapidstart.html" data-search="Rapid Start">
						Rapid Start
					</a>
				</li>
				
			
			
		
			
				
				
				<li class="search-container">
					<a class="page" href="getstarted.html" data-search="Get Started with JMVC">
						Get Started with JMVC
					</a>
				</li>
				
			
			
		
			
				
				
				<li class="search-container">
					<a class="page" href="mvc.html" data-search="Get Started with CanJS">
						Get Started with CanJS
					</a>
				</li>
				
			
			
		
			
				
				
				<li class="search-container">
					<a class="page" href="tutorials.jquerypp.html" data-search="Get Started with jQuery++">
						Get Started with jQuery++
					</a>
				</li>
				
			
			
		
			
				
				
				<li class="search-container">
					<a class="page" href="funcunit.getstarted.html" data-search="Get Started with FuncUnit">
						Get Started with FuncUnit
					</a>
				</li>
				
			
			
		
			
				
				
				<li class="search-container active">
					<a class="page" href="organizing.html" data-search="Organizing Your App">
						Organizing Your App
					</a>
				</li>
				
			
			
		
			
				
				
				<li class="search-container">
					<a class="page" href="ajaxy.html" data-search="Searchable Ajax Apps">
						Searchable Ajax Apps
					</a>
				</li>
				
			
			
		
			
				
				
				<li class="search-container">
					<a class="page" href="services.html" data-search="Ajax Service Guidelines">
						Ajax Service Guidelines
					</a>
				</li>
				
			
			
		
			
				
				
				<li class="search-container">
					<a class="page" href="done.html" data-search="Upgrading to 3.3">
						Upgrading to 3.3
					</a>
				</li>
				
			
			
		
	</ul>


		</li>
		
	
</ul>

	</nav>
	<article class="content docs">
		<section class="title">
			<div class="pull-right">
	<ul class="tags">
		<li>page</li>
	</ul>
	<ul class="links">
		
			<li><a href="">source</a></li>
		
		
			
		
		
	</ul>
</div>

<h1>
Organizing Your App

	
		<span class="module">organizing</span>
	


</h1>

<span class="inherits">&nbsp;</span>

		</section>

		<section class="contents">
		</section>

		<section class="description">
			
		</section>

		

		

		
		<section class="comment">
			<p>The secret to building large apps is to NEVER build
large apps.  Break up your applications into small 
pieces.  Then assemble those testable, bite-sized pieces 
into your big application.</p>

<p>JavaScriptMVC 3.X is built with this pattern in 
mind. As opposed to a single flat 'scripts' folder, 
JavaScriptMVC breaks up your app into
manageable, isolated modules. This tutorial discusses
the reasons for doing this and patterns for doing it.</p>

<h2>Why</h2>

<p>Traditionally JavaScript, CSS and static resources were seen as second-class
citizens when compared to server code.  JavaScript was put in a single
flat 'scripts' folder that looked like:</p>

<pre><code>button.js
jquery.ui.calendar.js
contactmanager.js
tabs.js
jquery.js
nav.js
resizer.js
\test
  button_test.js
  contactmanager.js
  tabs_test.js
  nav_test.js
</code></pre>

<p>This was OK for a limited amount of JavaScript; however; client code
increasingly represents a larger percentage of an 
app's codebase.  What works for 10 files does not work for 100.</p>

<p>Complicating matters, an individual JavaScript file might have dependencies on
non-JavaScript resources.  A menu might need
a specific stylesheet, images, or <a href="can.view.html">client side template</a>.  </p>

<p>Spreading these dependencies across images, styles, and template folders
makes it more difficult to know what depends on what. Over the lifetime
of an an application, it makes it more likely you'll be loading 
resources that are not needed.</p>

<h3>The Fix</h3>

<p>JavaScriptMVC gives each resource you author it's own folder.  Typically,
the folder will hold the resource, its demo page, test page,
test script, and any other files specific to that resource.</p>

<p>For example, a tabs folder might look like:</p>

<pre><code>\tabs
  tabs.js        - the code for a tabs widget 
  tabs.html      - a demo page
  funcunit.html  - a test page
  tabs_test.js   - test code
  tabs.css       - css for the tab
</code></pre>

<p>The idea is that we can work on <code>tabs.js</code> in complete isolation.</p>

<h2>How</h2>

<p>Before we discuss best practices for organizing your application, a little
throat clearing ...</p>

<blockquote>
  <p>Every app is different. Providing a single folder structure for
  all applications is impossible. However, there are several useful 
  patterns that when understood can keep your
  application under control. JavaScriptMVC is extremely flexible so use your best judgement!</p>
</blockquote>

<p>This guide walks you through starting with a small-ish example app and where you would add
features over time.  Before the example, it's good to know some JavaScript terminology:</p>

<h3>App and Library Folders</h3>

<p>In general, a JavaScriptMVC application is divided into two root folders: an app folder and
library folder. The app folder code typically 'steals' and configures 'library' code.  </p>

<h4>Application Folder</h4>

<p>The application (or app) folder houses code specific to a particular 
application.  The code in this folder is very unlikely to be
used in other places.  The folder name reflects the name of the application 
being built.  </p>

<p>Create an application folder structure with:</p>

<pre><code>js jmvc\generate\app cms
</code></pre>

<h4>Library Folders</h4>

<p>A library folder is for general code that 
can be reused across several applications.  It is the perfect place for 
reusable controls like a tabs widget.  Typically folder names reflect
the name of the organization building the controls.  </p>

<h3>Module Types</h3>

<p>An application is comprised of various modules.  JavaScriptMVC's code generators can 
be used to create .</p>

<p><strong>Model</strong> - A model represents a set of services. Typically, models exist within 
an application folder's <code>models</code> directory and are used to request 
data.</p>

<p>Generate a model like:</p>

<pre><code>js jmvc\generate\model cms\models\image
</code></pre>

<p><strong>Control</strong> - A <a href="can.Control.html">can.Control</a> can be a traditional view (a tabs widget) or
a traditional controller (coordinates model and view). Reusable controls are 
added to library folders.  Controls specific
to an application should be put in a folder within an application folder.</p>

<p>Generate a controller like:</p>

<pre><code>js jmvc\generate\control bitovi\tabs
</code></pre>

<p><strong>Plugin</strong> - A plugin is a low-level reusable module such as a special event or dom extension.
It does not typically have a visible component.  These should be added to library folders.</p>

<pre><code>js jmvc\generate\plugin bitovi\range
</code></pre>

<h2>Example Application</h2>

<p>The example is a content management system that organizes 'videos', 'images', and 
'articles' under a tabbed layout.  For each content type, the user needs
to be able to edit a selected item of that type.</p>

<p><img class='image_tag' src='tutorials/cms.png' /></p>

<p>If the application's name is <strong>cms</strong> and it is built by <strong>Bitovi</strong>, a basic version's
folder structure might look like:</p>

<pre><code>\cms
  \models    - models for the CMS
  \views     - views to configure the grid
  cms.js
\bitovi
  \tabs      - a basic tabs widget
  \edit      - binds a form to edit a model instance
  \grid      - a configurable grid
    \views
</code></pre>

<p>This basic version assumes that we can configure the grid and edit widget
enough to produces the desired functionality. In this case,
<code>cms/cms.js</code> might look like:</p>

<pre><code>// load dependencies
steal('bitovi/tabs',
      'bitovi/grid',
      'bitovi/create',
      './models/image.js',
      './models/video.js',
      './models/article.js',
      function(
          Tabs, Grid, Create, 
          Image, Video, Article
      ){

  // add tabs to the page
  var tabs = new Tabs('#tabs');

  // Configure the video grid
  var videos = new Grid($videos, {
    model: Cms.Models.Video,
    view: "//cms/views/videos.ejs"
  }),
      videoEdit = new Edit('#videoEdit')

  // listen for when a video is selected
  videos.element.on('selected','li', 
    function(ev, video){
      // update the edit form with the selected 
      // video's attributes
      videoEdit.update(video);
    }
  );

  // Do the same for images and articles
  var images = new Bitovi.Grid('#images', {
    model: Cms.Models.Image,
    view: "//cms/views/images.ejs"
  }),
      imageEdit = new Edit('#imageEdit');

  images.element.on('selected','li', 
    function(ev, image){
      imageEdit.update(video);
    }
  );

  var articles = new Grid('#articles', {
    model: Article,
    view: "//cms/views/article.ejs"
  }),
      articleEdit = new Edit('#articleEdit');

  articles.element.on('selected','li', 
    function(ev, article){
      articleEdit.update(video);
    }
  );

})
</code></pre>

<p>Notice that the <code>cms.js</code> configures the grid and edit widgets with
the cms folder's models and views.  This represents an ideal separation between
app specific code and reusable widgets.  However, it's extremely rare that 
widgets are able to provide all the functionality an app needs to meet its
requirements.</p>

<h3>More complexity</h3>

<p>Eventually, you won't be able to configure abstract widgets to satisfy
the requirements of your application.  For example, you might need to 
add specific functionality around listing and editing videos (such as a thumbnail editor).</p>

<p>This is application specific functionality and belongs 
in the application folder.  We'll encapsulate it in a controller <a href="can.Control.html">can.Control</a> for each type:</p>

<pre><code>\cms
  \articles - the articles tab
  \images   - the images tab
  \videos   - the videos tab
  \models  
  \views     
  cms.js
\bitovi
  \thumbnail
  \tabs     
  \edit      
  \grid      
    \views
</code></pre>

<p><code>cms/cms.js</code> now looks like:</p>

<pre><code>steal('cms/articles',
      'cms/images',
      'cms/videos',
      'bitovi/tabs',
      function(
        Articles, Images, Videos, Tabs
      ){

  new Tabs('#tabs');

  // add the video grid
  new Videos('#videos');

  // Do the same for images and articles
  new Images('#images');
  new Articles('#articles');

})
</code></pre>

<p><code>cms/articles/articles.js</code> might look like:</p>

<pre><code>steal('can', 
      'bitovi/grid',
      'bitovi/edit',
      './init.ejs',
      './article.ejs',
      'bitovi/models/article.js',
      function(can, 
               Grid, Edit, 
               initEJS, articleEJS, 
               Article){

  return can.Control({

    init : function(){
      // draw the html for the tab
      this.element.html(initEJS({}));

      // configure the grid
      new Grid(this.find('.grid'), {
        model: Article,
        view: articleEJS
      })

      this.editor = new Edit(".edit")
    },

    // when the grid triggers a select event
    "li select" : function(el, ev, article){
      this.editor.update(article)
    }
  });

});
</code></pre>

<h3>Adding leaves to the tree</h3>

<p>In the previous example, we moved most of the code in <code>cms/cms.js</code> into
an articles, images, and videos plugin.  Each of these plugins should
work independently from each other, have it's own tests and demo page.</p>

<p>Communication between these high-level
controls should be configured in <code>cms/cms.js</code>.</p>

<p>Essentially, as your needs become more specific, you are encouraged to 
nest plugins within each other.</p>

<p>In this example, after separating out each type into it's own plugin, you might
want to split the type into edit and grid controls.  The resulting 
folder structure would look like:</p>

<pre><code>\cms
  \articles
    \grid
    \edit
  \images
    \grid
    \edit   
  \videos
    \grid
    \edit   
  \models  
  \views     
  cms.js
\bitovi
  \thumbnail
  \tabs     
  \edit      
  \grid      
</code></pre>

<p><code>cms/articles/articles.js</code> would look the same, except it would
change <strong>Grid</strong> and <strong>Edit</strong> to point to <code>cms/articles/grid</code> and
<code>cms/articles/edit</code>:</p>

<pre><code>steal('can', 
      'cms/articles/grid',
      'cms/articles/edit',
      './init.ejs',
      './article.ejs',
      'bitovi/models/article.js',
      function(can, 
               Grid, Edit, 
               initEJS, articleEJS, 
               Article){
   ...
})
</code></pre>

<p>JavaScriptMVC encourages you to organize your application folder as a tree.
The leaves of the tree are micro-controls that perform a specific task (such as
allowing the editing of videos).  </p>

<p>Higher-order controls (<code>cms/articles/articles.js</code>) combine leaves and other nodes 
into more complex functionality.  The root of the application is the application file 
(<code>cms/cms.js</code>).  It combines and configures all high-level widgets.</p>

<p>Communication between modules is done with the observer 
pattern (<a href="can.compute.html">can.compute</a> or <a href="can.Observe.html">can.Observe</a>) or with events.</p>

<p>With events, low-level controls use <code>$.fn.trigger</code> to send messages 'up' to higher-order
controls.  Higher-order controls typically call methods on lower-level controls</p>

<p>The Articles control listening to a 'select' event produced by
Grid and creating (or updating) the Edit control
is a great example of this.</p>

<p>The situation where this breaks down is usually when a 'state' needs to be shared and communicated
across several controls.  <a href="can.compute.html">can.compute</a> and  <a href="can.Observe.html">can.Observe</a> are useful 
for this situation.</p>

<h2>Conclusion</h2>

<p>This is an extremely abstract article, but hopefully illustrates a few
important trends of JavaScriptMVC organization:</p>

<ul>
<li>Put code specific to an app in the application folder.</li>
<li>Put reusable plugins, widgets, and other code into library folders.</li>
<li>Fill out the tree.</li>
</ul>
		</section>
		

		
	</article>
</div>



	<footer>
		<nav class="container">
			<a class="brand javascriptmvc" href="index.html"></a>
		</nav>
	</footer>
	<script type="text/javascript">
		window.Bitovi = {
			URL: {
				BUILDER: '',
				BUILDER_DATA: '',
				BITHUB: '',
				CDN: ''
			}
		}
		steal = {
			productionId: "production.js",
			executed: ["documentjs/site/static/build/production.css"]
		}
	</script>
	<script type='text/javascript' 
	
		src="./static/steal.production.js"
	
		></script>
</body>

</html>
