(function(){$.Model.service.jsonRest=$.Model.service({url:"",type:".json",name:"",getSingularUrl:function(a,b){return this.singularUrl?this.singularUrl+"/"+b+this.type:this.url+this.getName(a)+"s/"+b+this.type},getPluralUrl:function(a){return this.pluralUrl||this.url+this.getName(a)+"s"+this.type},getName:function(a){return this.name||a.name},findAll:function(a){var b=this._service.getPluralUrl(this);$.ajax({url:b,type:"get",dataType:"json",data:a,success:this.proxy(["wrapMany",success]),error:error,
fixture:true})},getParams:function(a){var b=this.getName(this),d={};for(var e in a)d[b+"["+e+"]"]=a[e];return d},update:function(a,b,d,e){b=this._service.getParams(b);a=this._service.getSingularUrl(this,a);this._service.getPluralUrl(this);$.ajax({url:a,type:"put",dataType:"text",data:b,complete:function(g){if(/\w+/.test(g.responseText))return e(eval("("+g.responseText+")"));d({})},fixture:"-restUpdate"})},destroy:function(a,b,d){a=this._service.getSingularUrl(this,a);$.ajax({url:a,type:"delete",dataType:"text",
success:b,error:d,fixture:"-restDestroy"})},create:function(a,b,d){a=this._service.getParams(a);var e=this._service.getPluralUrl(this),g=this._service.getName(this);$.ajax({url:e,type:"post",dataType:"text",complete:function(c,f){f!="success"&&d(c,f);if(/\w+/.test(c.responseText)){c=eval("("+c.responseText+")");if(c[g]){b(c[g]);return}return d(c)}f=c.responseText;try{f=c.getResponseHeader("location")}catch(h){}if(f)if(c=f.match(/\/[^\/]*?(\w+)?$/))return b({id:parseInt(c[1])});b({})},data:a,fixture:"-restCreate"})}})})(jQuery);
