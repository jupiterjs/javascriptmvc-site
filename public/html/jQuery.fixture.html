<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN"
		"http://www.w3.org/TR/html4/strict.dtd">
<html lang='en'>
<head><script type="text/javascript" src="http://localhost:5555?[]&amp;_=0.670577245298773"></script>
	<title>jQuery.fixture</title>
	<link rel="stylesheet" type="text/css" href="../documentjs/jmvcdoc/style.css">
	<link rel="shortcut icon" href="../documentjs/jmvcdoc/images/favicon.ico">
	<script type="text/javascript" src="http://www.google-analytics.com/ga.js"></script><script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-xxxxx-4']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script>
<link rel="stylesheet" href="file:////Users/alexisabril/Projects/javascriptmvc-site/javascriptmvc/documentjs/jmvcdoc/style.css" type="text/css"></head><body>
<div id="documentation">
	<div id="top">
		<div class="topCorner">
			<div class="right"></div>
			<div class="left"></div>
		</div>
		<div class="content">
			<div id="searchRoundCorners">
				<div class="jmvcdoc_search"><input id="search" type="input"><span title="clear term" class="remove"></span></div>
			</div>
			<div id="defaults">
				<ul id="menu" class="ui-menu">
					<li class="ui-menu-item">
						<a class="menuLink" href="#favorites"><span class="menuSpan">Favorites</span></a>
					</li>
					<li class="ui-menu-item">
						<a class="menuLink" href="../follow.html" title="Follow"><span class="menuSpan red">Follow</span></a>
					</li>
					<li class="ui-menu-item">
						<a class="menuLink" href="../contribute.html" title="Contribute"><span class="menuSpan red">Contribute</span></a>
					</li>
					<li class="ui-menu-item">
						<a class="menuLink" href="../code.html" title="Code"><span class="menuSpan red">Code</span></a>
					</li>
				</ul>
			</div>
			<div class="logo-text"><a href="http://javascriptmvc.com"><img src="../documentjs/jmvcdoc/images/logo80x30.png" class="logo-image"></a></div>
		</div>
		<div class="bottomCorner">
			<div>&nbsp;</div>
		</div>
	</div>
	<div id="bottom">
		<div id="nav" class="jmvcdoc_nav">


	<div id="selected">
		    
				
		<div class="content">
			    <a href="#!" class="selected choice page" style="padding-left: 20px">
			    	
					JavaScriptMVC
					
				</a>
				
		</div>
			
		<div class="spacer"><div>&nbsp;</div></div>
			
			
				
		<div class="content">
			    <a href="#!jquerymx" class="selected choice page" style="padding-left: 20px">
			    	
						<span class="remove" title="close"></span>
					
					jQueryMX
					
				</a>
				
		</div>
			
		<div class="spacer"><div>&nbsp;</div></div>
			
			
				
		<div class="content">
			    <a href="#!dom" class="selected choice page" style="padding-left: 20px">
			    	
						<span class="remove" title="close"></span>
					
					DOM Helpers
					
				</a>
				
		</div>
			
		<div class="spacer"><div>&nbsp;</div></div>
			
			
				
		<div class="content">
			    <a href="#!jQuery.fixture" class="selected choice function" style="padding-left: 20px">
			    	
						<span class="remove" title="close"></span>
					
					$.fixture
					
				</a>
				
		</div>
			
			
	</div>

<div id="results" style="display: block">
	<div class="content">
	    
			
		    <a href="#!jquery.fixture.0organizing" class="result choice page" style="padding-left: 20px">
		    	Organizing Fixtures
			</a>
			
		
			
		    <a href="#!jQuery.fixture.make" class="result choice function" style="padding-left: 20px">
		    	$.fixture.make
			</a>
			
		
			
		    <a href="#!jQuery.fixture.rand" class="result choice function" style="padding-left: 40px">
		    	rand
			</a>
			
		
	</div>
</div>


</div>
		<div id="doc_container">
			<div id="doc" class="jmvcdoc_content"><div class="top">
	<div class="content">
	    <h1>jQuery.fixture&nbsp;
	    	<span class="function type"><span class="typeEnd">function</span></span>&nbsp;
	    	<span class="favorite favoriteoff">&nbsp;&nbsp;&nbsp;</span></h1>
	    
	    
	    
	    <div class="plugin">
	        plugin: jquery/dom/fixture
	    </div>
	    
		
	    <div class="download">
	        download: <a href="http://jmvcsite.heroku.com/pluginify?plugins[]=jquery/dom/fixture/fixture.js"> jQuery.fixture</a>
	    </div>
	    
		
	    <div class="test">
	        test: <a href="file:////Users/alexisabril/Projects/javascriptmvc-site/javascriptmvc/jquery/dom/fixture/qunit.html">qunit.html</a>
	    </div>
	    
		
			<a href="https://github.com/jupiterjs/jquerymx/blob/master/dom/fixture/fixture.js#L181">Source</a>
		
	</div>	
</div>

 <div class="comment"><p><code>$.fixture</code> intercepts a AJAX request and simulates
the response with a file or function. They are a great technique 
when you want to develop JavaScript 
independently of the backend. </p>

<h2>Types of Fixtures</h2>

<p>There are two common ways of using fixtures.  The first is to 
map Ajax requests to another file.  The following 
intercepts requests to <code>/tasks.json</code> and directs them 
to <code>fixtures/tasks.json</code>:</p>

<pre><code class=" javascript">$.fixture(<span class="string">"/tasks.json"</span>,<span class="string">"fixtures/tasks.json"</span>);
</code></pre>

<p>The other common option is to generate the Ajax response with
a function.  The following intercepts updating tasks at
<code>/tasks/ID.json</code> and responds with updated data:</p>

<pre><code class=" javascript">$.fixture(<span class="string">"PUT /tasks/{id}.json"</span>, <span class="function"><span class="keyword">function</span><span class="params">(original, settings, headers)</span>{</span>
   <span class="keyword">return</span> { updatedAt : <span class="keyword">new</span> Date().getTime() }
})
</code></pre>

<p>We categorize fixtures into the following types:</p>

<ul>
<li><strong>Static</strong> - the response is in a file.</li>
<li><strong>Dynamic</strong> - the response is generated by a function.</li>
</ul>

<p>There are different ways to lookup static and dynamic fixtures.</p>

<h2>Static Fixtures</h2>

<p>Static fixtures use an alternate url as the response of the Ajax request.</p>

<pre><code class=" javascript"><span class="comment">// looks in fixtures/tasks1.json relative to page</span>
$.fixture(<span class="string">"tasks/1"</span>, <span class="string">"fixtures/task1.json"</span>);

$.fixture(<span class="string">"tasks/1"</span>, <span class="string">"//fixtures/task1.json"</span>);
</code></pre>

<h2>Dynamic Fixtures</h2>

<p>Dynamic Fixtures are functions that get the details of 
the Ajax request and return the result of the mocked service
request from your server.  </p>

<p>For example, the following returns a successful response 
with JSON data from the server:</p>

<pre><code class=" javascript">$.fixture(<span class="string">"/foobar.json"</span>, <span class="function"><span class="keyword">function</span><span class="params">(orig, settings, headers)</span>{</span>
  <span class="keyword">return</span> [<span class="number">200</span>, <span class="string">"success"</span>, {json: {foo: <span class="string">"bar"</span> } }, {} ]
})
</code></pre>

<p>The fixture function has the following signature:</p>

<pre><code class=" javascript"><span class="function"><span class="keyword">function</span><span class="params">( originalOptions, options, headers )</span> {</span>
  <span class="keyword">return</span> [ status, statusText, responses, responseHeaders ]
}
</code></pre>

<p>where the fixture function is called with:</p>

<ul>
<li>originalOptions - are the options provided to the ajax method, unmodified,
and thus, without defaults from ajaxSettings</li>
<li>options - are the request options</li>
<li>headers - a map of key/value request headers</li>
</ul>

<p>and the fixture function returns an array as arguments for  ajaxTransport's <code>completeCallback</code> with:</p>

<ul>
<li>status - is the HTTP status code of the response.</li>
<li>statusText - the status text of the response</li>
<li>responses - a map of dataType/value that contains the responses for each data format supported</li>
<li>headers - response headers</li>
</ul>

<p>However, $.fixture handles the 
common case where you want a successful response with JSON data.  The 
previous can be written like:</p>

<pre><code class=" javascript">$.fixture(<span class="string">"/foobar.json"</span>, <span class="function"><span class="keyword">function</span><span class="params">(orig, settings, headers)</span>{</span>
  <span class="keyword">return</span> {foo: <span class="string">"bar"</span> };
})
</code></pre>

<p>If you want to return an array of data, wrap your array in another array:</p>

<pre><code class=" javascript">$.fixture(<span class="string">"/tasks.json"</span>, <span class="function"><span class="keyword">function</span><span class="params">(orig, settings, headers)</span>{</span>
  <span class="keyword">return</span> [ [ <span class="string">"first"</span>,<span class="string">"second"</span>,<span class="string">"third"</span>] ];
})
</code></pre>

<p>$.fixture works closesly with jQuery's 
ajaxTransport system.  Understanding it is the key to creating advanced
fixtures.</p>

<h3>Templated Urls</h3>

<p>Often, you want a dynamic fixture to handle urls 
for multiple resources (for example a REST url scheme). $.fixture's
templated urls allow you to match urls with a wildcard.  </p>

<p>The following example simulates services that get and update 100 todos.  </p>

<pre><code class=" javascript"><span class="comment">// create todos</span>
<span class="keyword">var</span> todos = {};
<span class="keyword">for</span>(<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; <span class="number">100</span>; i++) {
  todos[i] = {
    id: i,
    name: <span class="string">"Todo "</span>+i
  }
}
$.fixture(<span class="string">"GET /todos/{id}"</span>, <span class="function"><span class="keyword">function</span><span class="params">(orig)</span>{</span>
  <span class="comment">// return the JSON data</span>
  <span class="comment">// notice that id is pulled from the url and added to data</span>
  <span class="keyword">return</span> todos[orig.data.id]
})
$.fixture(<span class="string">"PUT /todos/{id}"</span>, <span class="function"><span class="keyword">function</span><span class="params">(orig)</span>{</span>
  <span class="comment">// update the todo's data</span>
  $.extend( todos[orig.data.id], orig.data );

  <span class="comment">// return data</span>
  <span class="keyword">return</span> {};
})
</code></pre>

<p>Notice that data found in templated urls (ex: <code>{id}</code>) is added to the original
data object.</p>

<h2>Simulating Errors</h2>

<p>The following simulates an unauthorized request 
to <code>/foo</code>.</p>

<pre><code class=" javascript">$.fixture(<span class="string">"/foo"</span>, <span class="function"><span class="keyword">function</span><span class="params">()</span>{</span>
    <span class="keyword">return</span> [<span class="number">401</span>,<span class="string">"{type: 'unauthorized'}"</span>]
   });
</code></pre>

<p>This could be received by the following Ajax request:</p>

<pre><code class=" javascript">$.ajax({
  url: <span class="string">'/foo'</span>,
  error : <span class="function"><span class="keyword">function</span><span class="params">(jqXhr, status, statusText)</span>{</span>
    <span class="comment">// status === 'error'</span>
    <span class="comment">// statusText === "{type: 'unauthorized'}"</span>
  }
})
</code></pre>

<h2>Turning off Fixtures</h2>

<p>You can remove a fixture by passing <code>null</code> for the fixture option:</p>

<pre><code class=" javascript"><span class="comment">// add a fixture</span>
$.fixture(<span class="string">"GET todos.json"</span>,<span class="string">"//fixtures/todos.json"</span>);

<span class="comment">// remove the fixture</span>
$.fixture(<span class="string">"GET todos.json"</span>, <span class="literal">null</span>)
</code></pre>

<p>You can also set [jQuery.fixture.on $.fixture.on] to false:</p>

<pre><code class=" javascript">$.fixture.on = <span class="literal">false</span>;
</code></pre>

<h2>Make</h2>

<p><a href="#!jQuery.fixture.make">$.fixture.make</a> makes a CRUD service layer that handles sorting, grouping,
filtering and more.</p>

<h2>Testing Performance</h2>

<p>Dynamic fixtures are awesome for performance testing.  Want to see what 
10000 files does to your app's performance?  Make a fixture that returns 10000 items.</p>

<p>What to see what the app feels like when a request takes 5 seconds to return?  Set
[jQuery.fixture.delay] to 5000.</p>

<div class="demo_wrapper demo" data-demo-src="jquery/dom/fixture/fixture.html"><div class="demo">
  <h3 class="demo_header header reset">
    <span class="ui-icon ui-icon-triangle-1-s"></span>
    <a href="javascript://">Demo</a>
  </h3>
  <div class="demo_content content" style="padding-top: 5px; padding-right: 5px; padding-bottom: 5px; padding-left: 5px; height: 606px; ">
    <iframe height="100%" frameborder="0" src="file:////Users/alexisabril/Projects/javascriptmvc-site/javascriptmvc/jquery/dom/fixture/fixture.html" style="height: 601px; "></iframe>
  </div>
  <h3 class="html_header header reset">
    <span class="ui-icon ui-icon-triangle-1-e"></span>
    <a href="javascript://">HTML</a>
  </h3>
  <div class="html_content content" style="display: none"><pre><code class="html"><span class="tag">&lt;<span class="keyword">div</span><span class="attribute"> id=<span class="value">"content"</span></span>&gt;</span><span class="tag">&lt;/<span class="keyword">div</span>&gt;</span></code></pre></div>
  <h3 class="source_header header reset">
    <span class="ui-icon ui-icon-triangle-1-e"></span>
    <a href="javascript://">Source</a>
  </h3>
  <div class="source_content content" style="display: none"><pre><code class="javascript">steal(<span class="string">'jquery/dom/fixture'</span>,
      <span class="string">'jquery/dom/form_params'</span>,
	  <span class="function"><span class="keyword">function</span><span class="params">()</span>{</span>

$.fixture(<span class="string">"/messages.php"</span>,
	<span class="string">'fixtures/messages.html'</span>)	

<span class="comment">// gets content from a fixture</span>
$.get(<span class="string">"/messages.php"</span>,
  <span class="function"><span class="keyword">function</span><span class="params">(html)</span>{</span>
    <span class="comment">// put the result in content</span>
    $(<span class="string">'#content'</span>).html(html)
  }, 
  <span class="string">'text'</span>);


<span class="comment">// makes 20 messages in a fixture</span>
$.fixture.make([<span class="string">"messages"</span>,<span class="string">"message"</span>],<span class="number">20</span>, <span class="function"><span class="keyword">function</span><span class="params">(i, messages)</span>{</span>
  <span class="keyword">return</span> {
    subject: <span class="string">"This is message "</span>+i,
    body: <span class="string">"Here is some text for this message"</span>,
    user: <span class="string">"Justin"</span>,
    createdAt: String(<span class="keyword">new</span> Date( Math.random() *  <span class="keyword">new</span> Date().getTime()   ))
  }
});

<span class="comment">// gets messages on submit</span>
$(<span class="string">"#getMessages"</span>).live(<span class="string">"submit"</span>,<span class="function"><span class="keyword">function</span><span class="params">(ev)</span>{</span>
    
  ev.preventDefault();
    
  <span class="comment">//get the limit and offset</span>
  <span class="keyword">var</span> params = $(<span class="keyword">this</span>).formParams().params;
    
  <span class="comment">//use -messages fixture created by make</span>
  $.ajax({
    url: <span class="string">"/messages.json"</span>,
    data: params,
    success: <span class="function"><span class="keyword">function</span><span class="params">(json)</span>{</span>
      $(<span class="string">"#messages"</span>).html( messagesHTML(json) )
    },
    dataType: <span class="string">"json"</span>,
    fixture: <span class="string">"-messages"</span>
  })
});


<span class="comment">// a fixture for creating messages</span>
$.fixture[<span class="string">"-createMessage"</span>] = <span class="function"><span class="keyword">function</span><span class="params">(settings, cbType)</span>{</span>
  <span class="comment">// add to the message data what the server would add</span>
  <span class="keyword">var</span> message = $.extend({
    id: arguments.callee.count++,
    user: <span class="string">"Justin"</span>,
    createdAt: String(<span class="keyword">new</span> Date())
  }, settings.data);
  
  message.id = $.fixture[<span class="string">"~messages"</span>].length;
    
  <span class="comment">// adds the message to the fixture data</span>
  $.fixture[<span class="string">"~messages"</span>].push(message);
    
  <span class="comment">// return the data for the callback</span>
  <span class="keyword">return</span> [message];
};


<span class="comment">// creates a message on submit</span>
$(<span class="string">"#message"</span>).live(<span class="string">"submit"</span>, <span class="function"><span class="keyword">function</span><span class="params">(ev)</span>{</span>
  ev.preventDefault();
    
  <span class="comment">// get message data</span>
  <span class="keyword">var</span> message = $(<span class="keyword">this</span>).formParams().message;
    
  <span class="comment">// uses -createMessage fixture</span>
  $.post(<span class="string">"/message.json"</span>, message,<span class="function"><span class="keyword">function</span><span class="params">(json)</span>{</span>
        
    <span class="comment">//clear the message form</span>
    $(<span class="string">'[name*=message]'</span>).val(<span class="string">""</span>);
    
    <span class="comment">//show the new message</span>
    $(<span class="string">'[name*=offset]'</span>).val(json.id)
    $(<span class="string">'[name*=limit]'</span>).val(<span class="number">1</span>)
    $(<span class="string">"#getMessages"</span>).submit();
        
  },<span class="string">'json'</span>,<span class="string">"-createMessage"</span>)
})

<span class="comment">//creates the html from message data</span>
<span class="keyword">var</span> messagesHTML = <span class="function"><span class="keyword">function</span><span class="params">(json)</span>{</span>
  <span class="keyword">var</span> html = [<span class="string">"&lt;h4&gt;Messages (count="</span>, 
              json.count,
              <span class="string">")&lt;/h4&gt;"</span>,
              <span class="string">"&lt;table&gt;"</span>,
              <span class="string">"&lt;tr&gt;"</span>],
      cols = [<span class="string">"subject"</span>,
	          <span class="string">"body"</span>,
			  <span class="string">"user"</span>,
			  <span class="string">"createdAt"</span>];
  
  <span class="comment">// html for the column headers		  </span>
  $.each(cols, <span class="function"><span class="keyword">function</span><span class="params">(i, prop)</span>{</span>
    html.push(<span class="string">"&lt;th&gt;"</span>+prop+<span class="string">"&lt;/th&gt;"</span>)
  })
  
  html.push(<span class="string">"&lt;/tr&gt;"</span>)
  
  <span class="comment">// html for the messages</span>
  $.each(json.data, <span class="function"><span class="keyword">function</span><span class="params">(m, message)</span>{</span>
    html.push(<span class="string">"&lt;tr&gt;"</span>)
    $.each(cols, <span class="function"><span class="keyword">function</span><span class="params">(i, prop)</span>{</span>
        html.push(<span class="string">"&lt;td&gt;"</span>+message[prop]+<span class="string">"&lt;/td&gt;"</span>)
    })
    html.push(<span class="string">"&lt;/tr&gt;"</span>)
  })
  
  html.push(<span class="string">"&lt;/table&gt;"</span>);
  <span class="keyword">return</span> html.join(<span class="string">""</span>);
}


});</code></pre></div>
</div>

</div></div>
 <h2>API</h2>
 <pre><code class=" javascript">$.fixture(settings, fixture) -&gt; undefined</code></pre>
  
  <div class="params">
  
    
      <div class="param ">
          <label>settings</label>
          <code>{Object|String}</code> 
		   <p>Configures the AJAX requests the fixture should 
intercept.  If an <strong>object</strong> is passed, the object's properties and values
are matched against the settings passed to $.ajax.  </p>

<p>If a <strong>string</strong> is passed, it can be used to match the url and type. Urls
can be templated, using <code>{NAME}</code> as wildcards.  </p>
      </div>
   
      <div class="param ">
          <label>fixture</label>
          <code>{Function|String}</code> 
		   <p>The response to use for the AJAX 
request. If a <strong>string</strong> url is passed, the ajax request is redirected
to the url. If a <strong>function</strong> is provided, it looks like:</p>

<pre><code class=" javascript">fixture( originalSettings, settings, headers    )
</code></pre>

<p>where:</p>

<ul>
<li>originalSettings - the orignal settings passed to $.ajax</li>
<li>settings - the settings after all filters have run</li>
<li>headers - request headers</li>
</ul>

<p>If <strong>null</strong> is passed, and there is a fixture at settings, that fixture will be removed,
allowing the AJAX request to behave normally.</p>
      </div>
 

 
     <div class="return">
         <label>returns</label> 
         <code>{undefined}</code> 
		 
     </div>
    
 
 </div></div>
			<div id="disqus_thread" style="display: none; "></div>
		</div>
	</div>
</div>
<div id="low">
	<a href="http://jupiterit.com">ï¿½ Jupiter Consulting - JavaScriptMVC Training and Support</a>
	<a class="api_links" href="http://javascriptmvc.com/docs/api.html#&amp;who=api"></a>
</div>
<script type="text/javascript">
	DOCS_SRC_MAP = {
		'funcunit' : 'https://github.com/jupiterjs/funcunit',
		'jquery' : 'https://github.com/jupiterjs/jquerymx',
		'steal' : 'https://github.com/jupiterjs/steal',
		'documentjs' : 'https://github.com/jupiterjs/documentjs'
	};
	DOCS_LOCATION = "docs/" //adds searchData to this
	JMVCDOC_TIMESTAMP = 264302280
	COMMENTS_LOCATION = 'http://jmvcs3.disqus.com/embed.js';
</script>
<script type="text/javascript" src="../steal/steal.js?documentjs/jmvcdoc">
</script>

<style type="text/css">
  body > iframe { width: 0;} 
  #dsq-content #dsq-form-area .dsq-attach-media-container iframe { height: 13px; padding: 0;}
</style>
	

</body>
</html>