<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN"
		"http://www.w3.org/TR/html4/strict.dtd">
<html lang='en'>
<head><script type="text/javascript" src="http://localhost:5555?[]&amp;_=0.260240213945508"></script>
	<title>Model</title>

	<link rel="shortcut icon" href="../documentjs/jmvcdoc/images/favicon.ico">
	<script type="text/javascript" src="http://www.google-analytics.com/ga.js"></script><script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-xxxxx-4']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script>
<style type="text/css">.floatLeft {
  float: left;
}
/* content types */
body {
  font-family: sans-serif, "Trebuchet MS", Verdana, Helvetica, Arial;
  margin: 20px 0px 0px 0px;
  background: #fcfcfc;
  font-size: 17px;
}
h1 {
  position: relative;
  margin: 0;
}
h1 span.subtitle {
  color: #888888;
  font-style: italic;
}
h2 {
  border-bottom: solid 1px	#C3E2EF;
  padding-bottom: 3px;
}
h3 {
  color: #96A84A;
  font-size: 1.3em;
  margin-bottom: 10px;
}
h5 {
  margin-bottom: 0px;
  padding-bottom: 0px;
}
pre {
  background-color: #F9F7DF;
  border: solid 1px white;
  margin: 13px 0;
  padding: 13px;
}
dl {
  margin: 10px;
}
td {
  padding: 3px;
  vertical-align: top;
}
.error {
  border: solid 1px red;
}
.error_text {
  color: red;
  font-size: 10px;
}
/* LAYOUT =========================*/
#documentation {
  width: 1024px;
  margin: 0px auto;
}
#top {
  margin: 0 20px 20px 20px;
  padding: 10px 0;
  border-radius: 5px;
  -webkit-border-radius: 5px;
  -moz-border-radius: 5px;
  background: #004634;
  background: -webkit-gradient(linear, left bottom, left top, color-stop(0, #004634), color-stop(1, #01654a));
  background: -ms-linear-gradient(bottom, #004634, #01654a);
  background: -moz-linear-gradient(center bottom, #004634 0%, #01654a 100%);
  background: -o-linear-gradient(bottom, #004634 0%, #01654a 100%);
  background: linear-gradient(bottom, #004634 0%, #01654a 100%);
  /*filter: progid:DXImageTransform.Microsoft.gradient( startColorstr='#01654a', endColorstr='#004634',GradientType=0 ); /* IE6-9 */

  -webkit-box-shadow: 0px 1px 0px #ffffff;
  -moz-box-shadow: 0px 1px 0px #ffffff;
  box-shadow: 0px 1px 0px #ffffff;
}
#top .content {
  /*height:34px;*/

  margin: 0 10px;
  overflow: auto;
}
#top #searchRoundCorners {
  float: left;
  width: 293px;
  height: 15px;
  padding: 0px;
  margin: 0px;
  zoom: 1;
  display: inline;
  padding-top: 5px;
}
#top #search {
  width: 273px;
  font-size: 14px;
  font-family: "Trebuchet MS", Verdana, Helvetica, Arial, sans-serif;
  float: left;
  border: none;
  background: #FFFFFF;
  outline: none;
  margin-left: 10px;
  position: absolute;
  margin: 0 0 0 10px;
  padding: 3px;
  border-radius: 5px;
  -webkit-border-radius: 5px;
  -moz-border-radius: 5px;
  border: 1px solid #004634;
  -webkit-box-shadow: 0px 1px 0px #0f8563;
  -moz-box-shadow: 0px 1px 0px #0f8563;
  box-shadow: 0px 1px 0px #0f8563;
}
#top .logo-text a {
  color: white;
  float: right;
  left: -8px;
  position: relative;
  top: -4px;
  text-decoration: none;
  border: none;
}
#top .logo-image {
  left: 4px;
  position: relative;
  top: 8px;
  border: none;
}
/* TOP MENU STYLE ===== */
#defaults {
  float: left;
  font-weight: bold;
  width: 400px;
  margin-left: 10px;
  margin-bottom: 1px;
  height: 35px;
  line-height: 35px;
}
#defaults a {
  color: white;
  /*padding: 0px 10px;*/

  margin: 0 1px;
  text-decoration: none;
}
#defaults .ui-menu {
  height: 25px;
  line-height: 25px;
  margin: 7px 0px;
  padding: 0px;
  list-style-image: none;
  list-style-position: outside;
  list-style-type: none;
  position: absolute;
  z-index: 1000;
}
#defaults .ui-menu-item {
  float: left;
  /*padding:0.5em 1em;*/

  cursor: pointer;
}
#defaults .menuLink, #defaults .menuSpan {
  display: inline;
  height: 25px;
  float: left;
  cursor: pointer;
  font-size: 16px;
  text-shadow: 0px -1px #000000;
}
#defaults .menuSpan {
  padding-left: 10px;
  padding-right: 10px;
}
#defaults .menuLink:hover .menuSpan, #defaults .menuLink:hover span.red {
  background-color: #899d09;
  color: white;
  border-radius: 3px;
  -webkit-border-radius: 3px;
  -moz-border-radius: 3px;
  text-shadow: 0px 1px #333;
  -webkit-box-shadow: 0px 1px 0px #003f2f;
  -moz-box-shadow: 0px 1px 0px #003f2f;
  box-shadow: 0px 1px 0px #003f2f;
}
html*#searchRoundCorners {
  /* ie7 hack */

  padding: 7px;
}
.inside td {
  vertical-align: middle;
}
#bottom {
  margin: 0px 20px;
  clear: both;
}
#bottom p, #bottom ul, #bottom ol {
  color: #333;
  line-height: 24px;
}
#bottom a {
  color: #1f54c6;
}
#bottom p code {
  border: solid 1px #F9F7DF;
  white-space: nowrap;
  background-color: #eeeeee;
}
#bottom h2 code, #bottom h3 code {
  font-size: 17px;
  font-weight: normal;
  color: #333333;
  border: solid 1px #F9F7DF;
  background-color: #f9f9f9;
}
#nav {
  width: 300px;
  min-height: 10px;
  float: left;
  /*background-color: #2D2E26;*/
  /*#B8B495*/

  /*background-color:rgb(239,242,213);*/

  overflow: auto;
  margin-right: 20px;
  margin-bottom: 20px;
}
#nav a {
  display: block;
  padding: 5px;
  text-decoration: none;
  font-size: 14px;
  /*color: #F1F1C3;*/

  color: #404038;
  border: none;
  outline: none;
}
#nav #selected {
  margin: 0 0 10px 0;
}
#nav #selected .selected {
  font-size: 17px;
  font-weight: bold;
}
#nav #selected .spacer {
  height: 10px;
  background: #fcfcfc;
}
#nav #selected .content {
  margin: 0 0px;
  clear: both;
}
#nav #selected .content a {
  padding: 5px 10px;
  border-radius: 5px;
  -webkit-border-radius: 5px;
  -moz-border-radius: 5px;
  background-color: #d2d988;
}
#nav #selected .content .highlight {
  background-color: #d7e1ad;
}
#nav #results {
  /*margin:10px 0 0 0;*/

  background-color: #e6f1ba;
  padding: 5px 0;
}
#nav #results .highlight {
  /*background-color: #3C3D32;*/

  background-color: #b6dceb;
}
#nav #results .open {
  /*the opened color*/

  background: #a0b348;
  color: white;
  font-weight: bold;
}
#nav .faded {
  color: gray;
}
#nav .prototype, #nav .static {
  color: gray;
}
#nav .class, #nav .constructor {
  font-weight: bold;
}
#nav .attribute {
  color: red;
}
#doc_container {
  margin-right: 0px;
  margin-left: 320px;
}
#doc {
  /*line-height:24px;*/

  /*padding: 0 20px 0 0;*/

  margin: 0;
}
#doc .type {
  color: gray;
  font-size: 0.8em;
}
#doc .content .type, #doc .typeEnd {
  text-shadow: none;
  display: inline-block;
  font-size: 0.7em;
  color: #FFFFFF;
  background: url("file:////Users/fred/Projects/jupiter/javascriptmvc-site/javascriptmvc/documentjs/jmvcdoc/images/type.png") no-repeat;
  background-position: 0 0;
  vertical-align: middle;
  margin-left: -9px;
  margin-bottom: 3px;
  *margin-bottom: 0px;
  /* ie7 */

}
#doc .typeEnd {
  display: block;
  line-height: 21px;
  background-position: 100% 0;
  margin-left: 11px;
  padding: 0 10px 0 5px;
  float: left;
}
#doc .top {
  margin: 0 0 20px;
  line-height: 38px;
  background-color: #c3e2ef;
  padding: 5px 0 1px 0;
  text-shadow: 0px 1px white;
  color: #222;
  border-radius: 5px;
  -webkit-border-radius: 5px;
  -moz-border-radius: 5px;
}
#doc .top .content {
  margin: 5px 20px 5px 20px;
}
#doc .favorite {
  float: right;
  cursor: pointer;
  background-repeat: no-repeat;
  /*background-position: left 16px;*/

  /* ie7 hacks */

  *position: absolute;
  top: 5px;
  right: 0;
}
#doc .favoriteon {
  background-image: url(file:////Users/fred/Projects/jupiter/javascriptmvc-site/javascriptmvc/documentjs/jmvcdoc/images/fav-on.png);
}
#doc .favoriteoff {
  background-image: url(file:////Users/fred/Projects/jupiter/javascriptmvc-site/javascriptmvc/documentjs/jmvcdoc/images/fav-off.png);
}
#disqus_thread {
  margin: 0;
}
.remove {
  float: right;
  display: block;
  width: 16px;
  text-align: center;
  height: 16px;
  background-image: url('file:////Users/fred/Projects/jupiter/javascriptmvc-site/javascriptmvc/documentjs/jmvcdoc/images/sidebar_top_close.png');
  margin: 1px -4px 0 0;
  opacity: 0.5;
}
.remove :hover {
  opacity: 1;
}
.jmvcdoc_search {
  position: relative;
}
.jmvcdoc_search .remove {
  display: none;
  position: absolute;
  top: 3px;
  right: 11px;
}
#low {
  font-size: 12px;
  margin: 10px auto;
  text-align: center;
  color: white;
  background: #e0e0e0;
  height: 30px;
  line-height: 30px;
  border-radius: 5px;
  -webkit-border-radius: 5px;
  -moz-border-radius: 5px;
  clear: both;
  width: 1024px;
}
#low a {
  color: #666;
  text-decoration: none;
  font-weight: bold;
}
/* CONTENT FORMATTING ============= */
.param, .return {
  text-indent: -48px;
  margin-left: 48px;
}
.param *, .return * {
  text-indent: 0px;
}
.param label, .return label {
  color: #808080;
  font-size: 10pt;
  font-weight: bold;
  margin: 0;
}
.options {
  margin-left: 40px;
  margin-right: 40px;
  text-align: left;
}
.options th {
  border-bottom: 1px solid #EEEEEE;
  font-family: "Helvetica Neue", Arial, sans-serif;
  font-size: 0.8em;
}
.options td {
  border-bottom: 1px solid #EEEEEE;
  font-size: 10pt;
  line-height: 150%;
  padding: 3px;
  vertical-align: top;
}
.signiture {
  border-color: #9C6854;
  background: none;
  background-color: white;
}
.params {
  margin-left: 13px;
}
code .comment {
  color: #007000;
}
.string {
  color: Gray;
}
.keyword {
  color: #800080;
}
code .params {
  color: blue;
  margin: 0px;
}
.magic {
  background-color: #FFF7D7;
}
.console {
  color: blue;
}
.this {
  color: #0000C0;
}
table pre {
  margin: 0px;
}
.floatLeft {
  float: left;
}
h2.spaced {
  clear: left;
  padding-top: 18px;
}
.warn {
  margin: 13px;
  padding: 13px;
  font-size: 11px;
  border: 1px solid #9C6854;
  background-color: #eeeeee;
}
.tip {
  font-size: 0.8em;
  font-family: verdana;
  padding-left: 13px;
}
.noborder {
  border: none;
}
.floatLeft .noborder {
  padding-right: 10px;
}
iframe {
  display: block;
  clear: right;
  width: 100%;
  border: 1px solid #cccccc;
  padding: 0 0 10px 10px;
  margin: 10px 0 10px 0;
  background-color: #eeeeee;
}
.iframe_wrapper {
  border: 1px solid #ffffff;
}
.iframe_menu_button {
  display: block;
  float: right;
  width: 100px;
  background-color: #cccccc;
  border-top: 1px solid #999999;
  border-left: 1px solid #999999;
  border-right: 1px solid #999999;
  cursor: pointer;
}
.iframe_menu {
  list-style-image: none;
  list-style-position: outside;
  list-style-type: none;
  font-size: 0.7em;
  background-color: #ffffff;
  border: 1px solid #999999;
  padding: 5px;
  margin: 0;
}
.iframe_menu_item {
  margin: 5px 2px 0px 2px;
}
/* @demo css
-------------*/
.demo .reset {
  padding: 0;
  margin: 0;
  border: 0;
  outline: 0;
  line-height: 1.3;
  text-decoration: none;
  font-size: 100%;
  list-style: none;
}
.demo .header a {
  font-family: "Trebuchet MS", Verdana, Helvetica, Arial, sans-serif;
  font-size: 12px;
  /*background-color: #AABF54;*/

  background-color: #D2D988;
  display: block;
  padding: .5em .5em .5em 2.2em;
  margin: 0;
  color: #FFFFFF;
  cursor: pointer;
  position: relative;
  margin-top: 1px;
  zoom: 1;
  /*border: 1px solid #AABF54;*/

  border: 1px solid #D2D988;
  text-decoration: none;
}
.demo .header .ui-icon {
  position: absolute;
  left: .5em;
  top: 50%;
  margin-top: -8px;
}
.demo .content {
  border: 1px solid #AABF54;
}
.demo .content iframe {
  padding: 0;
  margin: 0;
  background-color: #FFFFFF;
  border: none;
}
.demo pre {
  padding: 10px;
  margin: 0px;
  background-image: none;
}
.demo pre code {
  font-family: "Courier New";
  border: none;
}
.component {
  margin-right: 12px;
  height: 80px;
  float: left;
}
.whisper {
  color: #96A84A;
}
/* menu items */
iframe.pluginify {
  border: none;
  background: none;
  margin: 0px;
  height: 2060px;
  padding: 0px;
}
#tooltip {
  background-color: #b6dceb;
  height: 16px;
  padding: 5px;
  border-top: solid 5px white;
  border-bottom: solid 5px white;
  border-right: solid 5px white;
}
</style></head><body>
<div id="documentation">
	<div id="top">
		<div class="content">
			<div id="searchRoundCorners">
				<div class="jmvcdoc_search"><input id="search" type="input"><span title="clear term" class="remove"></span></div>
			</div>
			<div id="defaults">
				<ul id="menu" class="ui-menu">
					<li class="ui-menu-item">
						<a class="menuLink" href="#favorites"><span class="menuSpan">Favorites</span></a>
					</li>
					<li class="ui-menu-item">
						<a class="menuLink" href="../follow.html" title="Follow"><span class="menuSpan red">Follow</span></a>
					</li>
					<li class="ui-menu-item">
						<a class="menuLink" href="../contribute.html" title="Contribute"><span class="menuSpan red">Contribute</span></a>
					</li>
					<li class="ui-menu-item">
						<a class="menuLink" href="../code.html" title="Code"><span class="menuSpan red">Code</span></a>
					</li>
				</ul>
			</div>
			<div class="logo-text"><a href="http://javascriptmvc.com"><img src="../documentjs/jmvcdoc/images/logo80x30.png" class="logo-image"></a></div>
		</div>
	</div>
	<div id="bottom">
		<div id="nav" class="jmvcdoc_nav">


	<div id="selected">
		    
				
		<div class="content">
			    <a href="#!" class="selected choice page" style="padding-left: 20px">
			    	
					JavaScriptMVC
					
				</a>
				
		</div>
			
				<div class="spacer"><div>&nbsp;</div></div>
			
			
				
		<div class="content">
			    <a href="#!tutorials" class="selected choice page" style="padding-left: 20px">
			    	
						<span class="remove" title="close"></span>
					
					Tutorials
					
				</a>
				
		</div>
			
				<div class="spacer"><div>&nbsp;</div></div>
			
			
				
		<div class="content">
			    <a href="#!mvc" class="selected choice page" style="padding-left: 20px">
			    	
						<span class="remove" title="close"></span>
					
					Get Started with jQueryMX
					
				</a>
				
		</div>
			
			
	</div>

<div id="results" style="display: block">
	<div class="content">
	    
			
		    <a href="#!mvc.class" class="result choice page" style="padding-left: 20px" data-name="mvc.class">
		    	
					<span class="faded"></span>Class
				
			</a>
			
		
			
		    <a href="#!mvc.model" class="result choice page open" style="padding-left: 20px" data-name="mvc.model">
		    	
					<span class="faded"></span>Model
				
			</a>
			
		
			
		    <a href="#!mvc.view" class="result choice page" style="padding-left: 20px" data-name="mvc.view">
		    	
					<span class="faded"></span>View
				
			</a>
			
		
			
		    <a href="#!mvc.controller" class="result choice page" style="padding-left: 20px" data-name="mvc.controller">
		    	
					<span class="faded"></span>Controller
				
			</a>
			
		
	</div>
</div>


</div>
		<div id="doc_container">
			<div id="doc" class="jmvcdoc_content">
<div class="top">
	<div class="content">
	    <h1>Model&nbsp;
	    	<span class="page type"><span class="typeEnd">page</span></span>&nbsp;
	    	<span class="favorite favoriteoff">&nbsp;&nbsp;&nbsp;</span></h1>
	    
	    
	    
		
		
		
	</div>	
</div>


<p>JavaScriptMVC's model and its associated plugins provide lots of tools around organizing model data such as validations, associations, lists and more.  But the core functionality is centered around service encapsulation, type conversion, and events. </p>

<h3>Attributes and Observables</h3>

<p>Of absolute importance to a model layer is the ability to get and set properties on the modeled data and listen for changes on a model instance.  This is the Observer pattern and lies at the heart of the MVC approach - views listen to changes in the model.</p>

<p>Fortunately, JavaScriptMVC makes it easy to make any data observable.  A great example is pagination.  It's very common that multiple pagination controls exist on the page.  For example, one control might provide next and previous page buttons.  Another control might detail the items the current page is viewing (ex "Showing items 1-20").  All pagination controls need the exact same data:</p>

<ul>
<li>offset - the index of the first item to display</li>
<li>limit - the number of items to display</li>
<li>count - the total number of items</li>
</ul>

<p>We can model this data with JavaScriptMVC's $.Model like:</p>

<pre><code class=" javascript"><span class="keyword">var</span> paginate = <span class="keyword">new</span> $.Model({
  offset: <span class="number">0</span>,
  limit: <span class="number">20</span>,
  count: <span class="number">200</span>
});
</code></pre>

<p>The paginate variable is now observable.  We can pass it to pagination controls that can read from, write to, and listen for property changes.  You can read properties like normal or using the <code>model.attr(NAME)</code> method:</p>

<pre><code class=" javascript">assertEqual( paginate.offset, <span class="number">0</span> );
assertEqual( paginate.attr(<span class="string">'limit'</span>) , <span class="number">20</span> );
</code></pre>

<p>If we clicked the next button, we need to increment the offset.  Change property values with <code>model.attr(NAME, VALUE)</code>.  The following moves the offset to the next page:</p>

<pre><code class=" javascript">paginate.attr(<span class="string">'offset'</span>,<span class="number">20</span>);  
</code></pre>

<p>When paginate's state is changed by one control, the other controls need to be notified.  You can bind to a specific attribute change with <code>model.bind(ATTR, success( ev, newVal ) )</code> and update the control:</p>

<pre><code class=" javascript">paginate.bind(<span class="string">'offset'</span>, <span class="function"><span class="keyword">function</span><span class="params">(ev, newVal)</span>{</span>
  $(<span class="string">'#details'</span>).text( <span class="string">'Showing items '</span> + (newVal+<span class="number">1</span> )+ <span class="string">'-'</span> + <span class="keyword">this</span>.count )
})
</code></pre>

<p>You can also listen to any attribute change by binding to the <code>'updated.attr'</code> event:</p>

<pre><code class=" javascript">paginate.bind(<span class="string">'updated.attr'</span>, <span class="function"><span class="keyword">function</span><span class="params">(ev, newVal)</span>{</span>
  $(<span class="string">'#details'</span>).text( <span class="string">'Showing items '</span> + (newVal+<span class="number">1</span> )+ <span class="string">'-'</span> + <span class="keyword">this</span>.count )
})
</code></pre>

<p>The following is a next-previous jQuery plugin that accepts paginate data:</p>

<pre><code class=" javascript">$.fn.nextPrev = <span class="function"><span class="keyword">function</span><span class="params">(paginate)</span>{</span>
   <span class="keyword">this</span>.delegate(<span class="string">'.next'</span>,<span class="string">'click'</span>, <span class="function"><span class="keyword">function</span><span class="params">()</span>{</span>
     <span class="keyword">var</span> nextOffset = paginate.offset+paginate.limit;
     <span class="keyword">if</span>( nextOffset &lt; paginate.count){
       paginate.attr(<span class="string">'offset'</span>, nextOffset );
     }
   })
   <span class="keyword">this</span>.delegate(<span class="string">'.prev'</span>,<span class="string">'click'</span>, <span class="function"><span class="keyword">function</span><span class="params">()</span>{</span>
     <span class="keyword">var</span> nextOffset = paginate.offset-paginate.limit;
     <span class="keyword">if</span>( <span class="number">0</span> &lt; paginate.offset ){
       paginate.attr(<span class="string">'offset'</span>, Math.max(<span class="number">0</span>, nextOffset) );
     }
   });
   <span class="keyword">var</span> self = <span class="keyword">this</span>;
   paginate.bind(<span class="string">'updated.attr'</span>, <span class="function"><span class="keyword">function</span><span class="params">()</span>{</span>
     <span class="keyword">var</span> next = self.find(<span class="string">'.next'</span>),
         prev = self.find(<span class="string">'.prev'</span>);
     <span class="keyword">if</span>( <span class="keyword">this</span>.offset == <span class="number">0</span> ){
       prev.removeClass(<span class="string">'enabled'</span>);
     } <span class="keyword">else</span> { 
       prev.removeClass(<span class="string">'disabled'</span>);
     }
     <span class="keyword">if</span>( <span class="keyword">this</span>.offset &gt; <span class="keyword">this</span>.count - <span class="keyword">this</span>.limit ){
       next.removeClass(<span class="string">'enabled'</span>);
     } <span class="keyword">else</span> { 
       next.removeClass(<span class="string">'disabled'</span>);
     }

   })
};
</code></pre>

<p>There are a few problems with this plugin. First, if the control is removed from the page, it is not unbinding itself from paginate.  We'll address this when we discuss controllers. </p>

<p>Second, the logic protecting a negative offset or offset above the total count is done in the plugin.  This logic should be done in the model. To fix this problem, we'll need to add additional constraints to limit what values limit, offset, and count can be.  We'll need to create a pagination class.</p>

<h3>Extending Model</h3>

<p>JavaScriptMVC's model inherits from $.Class.  Thus, you create a model class by inheriting from <code>$.Model(NAME, [STATIC,] PROTOTYPE)</code>:</p>

<pre><code class=" javascript">$.Model(<span class="string">'Paginate'</span>,{
  staticProperty: <span class="string">'foo'</span>
},{
  prototypeProperty: <span class="string">'bar'</span>
})
</code></pre>

<p>There are a few ways to make the Paginate model more useful.  First, by adding setter methods, we can limit what values count and offset can be set to.  </p>

<h3>Setters</h3>

<p>Settter methods are model prototype methods that are named <code>setNAME</code>.  They get called with the val passed to <code>model.attr(NAME, val)</code> and a success and error callback.  Typically, the method should return the value that should be set on the model instance or call error with an error message.  Success is used for asynchronous setters.</p>

<p>The following paginate model uses setters to prevent negative counts the offset from exceeding the count by adding <code>setCount</code> and <code>setOffset</code> instance methods.</p>

<pre><code class=" javascript">$.Model(<span class="string">'Paginate'</span>,{
  setCount : <span class="function"><span class="keyword">function</span><span class="params">(newCount, success, error)</span>{</span>
    <span class="keyword">return</span> newCount &lt; <span class="number">0</span> ? <span class="number">0</span> : newCount;
  },
  setOffset : <span class="function"><span class="keyword">function</span><span class="params">(newOffset, success, error)</span>{</span>
    <span class="keyword">return</span> newOffset &lt; <span class="number">0</span> ? <span class="number">0</span> : Math.min(newOffset, !isNaN(<span class="keyword">this</span>.count - <span class="number">1</span>) ? <span class="keyword">this</span>.count : Infinity )
  }
})
</code></pre>

<p>Now the nextPrev plugin can set offset with reckless abandon:</p>

<pre><code class=" javascript"><span class="keyword">this</span>.delegate(<span class="string">'.next'</span>,<span class="string">'click'</span>, <span class="function"><span class="keyword">function</span><span class="params">()</span>{</span>
  paginate.attr(<span class="string">'offset'</span>, paginate.offset+paginate.limit);
})
<span class="keyword">this</span>.delegate(<span class="string">'.prev'</span>,<span class="string">'click'</span>, <span class="function"><span class="keyword">function</span><span class="params">()</span>{</span>
    paginate.attr(<span class="string">'offset'</span>, paginate.offset-paginate.limit );
});
</code></pre>

<h3>Defaults</h3>

<p>We can add default values to Paginate instances by setting the static <code>defaults</code> property.  When a new paginate instance is created, if no value is provided, it initializes with the default value.</p>

<pre><code class=" javascript">$.Model(<span class="string">'Paginate'</span>,{
  defaults : {
    count: Infinity,
    offset: <span class="number">0</span>,
    limit: <span class="number">100</span>
  }
},{
  setCount : <span class="function"><span class="keyword">function</span><span class="params">(newCount, success, error)</span>{</span> ... },
  setOffset : <span class="function"><span class="keyword">function</span><span class="params">(newOffset, success, error)</span>{</span> ... }
})

<span class="keyword">var</span> paginate = <span class="keyword">new</span> Paginate({count: <span class="number">500</span>});
assertEqual(paginate.limit, <span class="number">100</span>);
assertEqual(paginate.count, <span class="number">500</span>);
</code></pre>

<p>This is getting sexy, but the Paginate model can make it even easier to move to the next and previous page and know if it's possible by adding helper methods.</p>

<h3>Helper methods</h3>

<p>Helper methods are prototype methods that help set or get useful data on model instances.  The following, completed, Paginate model includes a <code>next</code> and <code>prev</code> method that will move to the next and previous page if possible.  It also provides a <code>canNext</code> and <code>canPrev</code> method that returns if the instance can move to the next page or not.</p>

<pre><code class=" javascript">$.Model(<span class="string">'Paginate'</span>,{
  defaults : {
    count: Infinity,
    offset: <span class="number">0</span>,
    limit: <span class="number">100</span>
  }
},{
  setCount : <span class="function"><span class="keyword">function</span><span class="params">( newCount )</span>{</span>
    <span class="keyword">return</span> Math.max(<span class="number">0</span>, newCount  );
  },
  setOffset : <span class="function"><span class="keyword">function</span><span class="params">( newOffset )</span>{</span>
    <span class="keyword">return</span> Math.max( <span class="number">0</span> , Math.min(newOffset, <span class="keyword">this</span>.count ) )
  },
  next : <span class="function"><span class="keyword">function</span><span class="params">()</span>{</span>
    <span class="keyword">this</span>.attr(<span class="string">'offset'</span>, <span class="keyword">this</span>.offset+<span class="keyword">this</span>.limit);
  },
  prev : <span class="function"><span class="keyword">function</span><span class="params">()</span>{</span>
    <span class="keyword">this</span>.attr(<span class="string">'offset'</span>, <span class="keyword">this</span>.offset - <span class="keyword">this</span>.limit )
  },
  canNext : <span class="function"><span class="keyword">function</span><span class="params">()</span>{</span>
    <span class="keyword">return</span> <span class="keyword">this</span>.offset &gt; <span class="keyword">this</span>.count - <span class="keyword">this</span>.limit
  },
  canPrev : <span class="function"><span class="keyword">function</span><span class="params">()</span>{</span>
    <span class="keyword">return</span> <span class="keyword">this</span>.offset &gt; <span class="number">0</span>
  }
})
</code></pre>

<p>Thus, our jQuery widget becomes much more refined:</p>

<pre><code class=" javascript">$.fn.nextPrev = <span class="function"><span class="keyword">function</span><span class="params">(paginate)</span>{</span>
   <span class="keyword">this</span>.delegate(<span class="string">'.next'</span>,<span class="string">'click'</span>, <span class="function"><span class="keyword">function</span><span class="params">()</span>{</span>
     paginate.attr(<span class="string">'offset'</span>, paginate.offset+paginate.limit);
   })
   <span class="keyword">this</span>.delegate(<span class="string">'.prev'</span>,<span class="string">'click'</span>, <span class="function"><span class="keyword">function</span><span class="params">()</span>{</span>
     paginate.attr(<span class="string">'offset'</span>, paginate.offset-paginate.limit );
   });
   <span class="keyword">var</span> self = <span class="keyword">this</span>;
   paginate.bind(<span class="string">'updated.attr'</span>, <span class="function"><span class="keyword">function</span><span class="params">()</span>{</span>
     self.find(<span class="string">'.prev'</span>)[paginate.canPrev() ? <span class="string">'addClass'</span> : <span class="string">'removeClass'</span>](<span class="string">'enabled'</span>)
     self.find(<span class="string">'.next'</span>)[paginate.canNext() ? <span class="string">'addClass'</span> : <span class="string">'removeClass'</span>](<span class="string">'enabled'</span>);
   })
};
</code></pre>

<h3>Service Encapsulation</h3>

<p>We've just seen how $.Model is useful for modeling client side state.  However, for most applications, the critical data is on the server, not on the client.  The client needs to create, retrieve, update and delete (CRUD) data on the server.  Maintaining the duality of data on the client and server is tricky business.   $.Model is used to simplify this problem.  </p>

<p>$.Model is extremely flexible.  It can be made to work with all sorts of services types and data types.  This book covers only how $.Model works with the most common and popular type of service and data type: Representational State Transfer (REST) and JSON.</p>

<p>A REST service uses urls and the HTTP verbs POST, GET, PUT, DELETE to create, retrieve, update, and delete data respectively.  For example, a tasks service that allowed you to create, retrieve, update and delete tasks might look like:</p>

<table>
  <tbody><tr>
    <th>ACTION</th><th>VERB</th><th>URL</th><th>BODY</th><th>RESPONSE</th>
  </tr>
  <tr>
   <td>Create a task</td><td>POST</td><td>/tasks</td><td>name=do the dishes</td><td><pre><code class=" javascript">{
  <span class="string">"id"</span>       : <span class="number">2</span>,
  <span class="string">"name"</span>     : <span class="string">"do the dishes"</span>,
  <span class="string">"acl"</span>      : <span class="string">"rw"</span> ,
  <span class="string">"createdAt"</span>: <span class="number">1303173531164</span> <span class="comment">// April 18 2011</span>
}</code></pre></td>
  </tr>
  <tr>
   <td>Get a task</td><td>GET</td><td>/task/2</td><td></td><td><pre><code class=" javascript">{
  <span class="string">"id"</span>       : <span class="number">2</span>,
  <span class="string">"name"</span>     : <span class="string">"do the dishes"</span>,
  <span class="string">"acl"</span>      : <span class="string">"rw"</span> ,
  <span class="string">"createdAt"</span>: <span class="number">1303173531164</span> <span class="comment">// April 18 2011</span>
}</code></pre><code></code></td>
  </tr>
  <tr>
   <td>Get tasks</td><td>GET</td><td>/tasks</td><td></td><td>
<pre><code class=" javascript">[{
  <span class="string">"id"</span>       : <span class="number">1</span>,
  <span class="string">"name"</span>     : <span class="string">"take out trash"</span>,
  <span class="string">"acl"</span>      : <span class="string">"r"</span>,
  <span class="string">"createdAt"</span>: <span class="number">1303000731164</span> <span class="comment">// April 16 2011</span>
},
{
  <span class="string">"id"</span>       : <span class="number">2</span>,
  <span class="string">"name"</span>     : <span class="string">"do the dishes"</span>,
  <span class="string">"acl"</span>      : <span class="string">"rw"</span> ,
  <span class="string">"createdAt"</span>: <span class="number">1303173531164</span> <span class="comment">// April 18 2011</span>
}]</code></pre>
</td>
  </tr>
  <tr>
   <td>Update a task</td><td>PUT</td><td>/task/2</td><td>name=take out recycling</td><td><pre><code class=" javascript">{
  <span class="string">"id"</span>       : <span class="number">2</span>,
  <span class="string">"name"</span>     : <span class="string">"take out recycling"</span>,
  <span class="string">"acl"</span>      : <span class="string">"rw"</span> ,
  <span class="string">"createdAt"</span>: <span class="number">1303173531164</span> <span class="comment">// April 18 2011</span>
}</code></pre><code></code></td>
  </tr>
  <tr>
   <td>Delete a task</td><td>DELETE</td><td>/task/2</td><td></td><td><pre><code class=" javascript">{}</code></pre><code></code></td>
  </tr>
</tbody></table>

<p>TODO: We can label the urls</p>

<p>The following connects to task services, letting us create, retrieve, update and delete tasks from the server:</p>

<pre><code class=" javascript">$.Model(<span class="string">"Task"</span>,{
  create  : <span class="string">"POST /tasks.json"</span>,
  findOne : <span class="string">"GET /tasks/{id}.json"</span>,
  findAll : <span class="string">"GET /tasks.json"</span>,
  update  : <span class="string">"PUT /tasks/{id}.json"</span>,
  destroy : <span class="string">"DELETE /tasks/{id}.json"</span>
},{ });
</code></pre>

<p>The following table details how to use the task model to CRUD tasks.</p>

<table>
  <tbody><tr>
    <th>ACTION</th><th>CODE</th><th>DESCRIPTION</th>
  </tr>
  <tr>
   <td>Create a task</td>
   <td><pre><code class=" javascript"><span class="keyword">new</span> Task({ name: <span class="string">'do the dishes'</span>})
  .save( 
    success( task, data ), 
    error( jqXHR) 
  ) -&gt; taskDeferred</code></pre></td>
   <td><p>To create an instance of a model on the server, first create an instance with <code>new Model(attributes)</code>.  Then call <code>save()</code>.</p>
<p>Save checks if the task has an id.  In this case it does not so save makes a create request with the task's attributes.  Save takes two parameters:</p>
   <ul>
     <li><code>success</code> - a function that gets called if the save is successful.  Success gets called with the <code>task</code> instance and the <code>data</code> returned by the server.</li>
     <li><code>error</code> - a function that gets called if there is an error with the request.  It gets called with jQuery's wrapped XHR object.</li>
   </ul>

   Save returns a deferred that resolves to the created task.
   </td>
  </tr>
  <tr>
   <td>Get a task</td>
   <td><pre><code class=" javascript">Task.findOne(params, 
  success( task ), 
  error( jqXHR) 
) -&gt; taskDeferred</code></pre></td>
   <td>Retrieves a single task from the server. It takes three parameters:
   <ul>
     <li><code>params</code> - data to pass to the server.  Typically an id like: <code>{id: 2}</code>.</li>
     <li><code>success</code> - a function that gets called if the request is succesful.  Success gets called with the <code>task</code> instance.</li>
     <li><code>error</code> - a function that gets called if there is an error with the request.</li>
   </ul>

   findOne returns a deferred that resolves to the task.
   </td>
  </tr>
   <tr><td>Get tasks</td>
   <td><pre><code class=" javascript">Task.findAll(params, 
  success( tasks ), 
  error( jqXHR) 
) -&gt; tasksDeferred</code></pre></td>
   <td>Retrieves an array of tasks from the server. It takes three parameters:
   <ul>
     <li><code>params</code> - data to pass to the server.  Typically, it's an empty object (<code>{}</code>) or filters: <code>{limit: 20, offset: 100}</code>.</li>
     <li><code>success</code> - a function that gets called if the request is succesful.  Success gets called with an array of task instances.</li>
     <li><code>error</code> - a function that gets called if there is an error with the request.</li>
   </ul>
   findOne returns a deferred that resolves to an array of tasks.
   </td>
  </tr>
  <tr>
   <td>Update a task</td>
   <td><pre><code class=" javascript">task.attr(<span class="string">'name'</span>,<span class="string">'take out recycling'</span>);
task.save( 
  success( task, data ), 
  error( jqXHR) 
) -&gt; taskDeferred</code></pre></td>
   <td><p>To update the server, first change the attributes of a model instance with  <code>attr</code>.  Then call <code>save()</code>.</p>
       <p>Save takes the same arguments and returns the same deferred as the create task case.</p>
   </td>
  </tr>
  <tr>
   <td>Destroy a task</td>
   <td><pre><code class=" javascript">task.destroy( 
  success( task, data ), 
  error( jqXHR) 
) -&gt; taskDeferred</code></pre></td>
   <td><p>Destroys a task on the server. Destroy takes two parameters:</p>
   <ul>
     <li><code>success</code> - a function that gets called if the save is successful.  Success gets called with the <code>task<code> instance and the <code>data</code> returned by the server.</code></code></li><code><code>
     <li><code>error</code> - a function that gets called if there is an error with the request.</li>
   </code></code></ul><code><code>

   Destroy returns a deferred that resolves to the destroyed task.
   </code></code></td>
  </tr>
</tbody></table>

<p>The <code>Task</code> model has essentially become a contract to our services!</p>

<h3>Type Conversion</h3>

<p>Did you notice how the server responded with createdAt values as numbers like <code>1303173531164</code>.  This number is actually April 18th, 2011.  Instead of getting a number back from <code>task.createdAt</code>, it would be much more useful if it returns a JavaScript date created with <code>new Date(1303173531164)</code>.  We could do this with a <code>setCreatedAt</code> setter.  But, if we have lots of date types, this will quickly get repetitive.  </p>

<p>To make this easy, $.Model lets you define the type of an attribute and a converter function for those types.  Set the type of attributes on the static <code>attributes</code> object and converter methods on the static <code>convert</code> object.</p>

<pre><code class=" javascript">$.Model(<span class="string">'Task'</span>,{
  attributes : {
    createdAt : <span class="string">'date'</span>
  },
  convert : {
    date : <span class="function"><span class="keyword">function</span><span class="params">(date)</span>{</span>
      <span class="keyword">return</span> <span class="keyword">typeof</span> date == <span class="string">'number'</span> ? <span class="keyword">new</span> Date(date) : date;
    }
  }
},{});
</code></pre>

<p>Task now converts createdAt to a Date type.  To list the year of each task, write:</p>

<pre><code class=" javascript">Task.findAll({}, <span class="function"><span class="keyword">function</span><span class="params">(tasks)</span>{</span>
  $.each(tasks, <span class="function"><span class="keyword">function</span><span class="params">()</span>{</span>
    console.log( <span class="string">"Year = "</span>+<span class="keyword">this</span>.createdAt.fullYear() )
  })
});
</code></pre>

<h3>CRUD Events</h3>

<p>Model publishes events when an instance has been created, updated, or destroyed. You can listen to these events globally on the Model or on an individual model instance. Use <code>MODEL.bind(EVENT, callback( ev, instance ) )</code> to listen for created, updated, or destroyed events.</p>

<p>Lets say we wanted to know when a task is created and add it to the page. After it's been added to the page, we'll listen for updates on that task to make sure we are showing its name correctly.  We can do that like:</p>

<pre><code class=" javascript">Task.bind(<span class="string">'created'</span>, <span class="function"><span class="keyword">function</span><span class="params">(ev, task)</span>{</span>
  <span class="keyword">var</span> el = $(<span class="string">'&lt;li&gt;'</span>).html(todo.name);
  el.appendTo($(<span class="string">'#todos'</span>));

  task.bind(<span class="string">'updated'</span>, <span class="function"><span class="keyword">function</span><span class="params">()</span>{</span>
    el.html(<span class="keyword">this</span>.name)
  }).bind(<span class="string">'destroyed'</span>, <span class="function"><span class="keyword">function</span><span class="params">()</span>{</span>
    el.remove()
  })

})
</code></pre>

<p>Please continue to <a href="#!mvc.view">View</a>.</p></div>
			<div id="disqus_thread" style="display: none; "></div>
		</div>
	</div>
</div>
<div id="low">
	<a href="http://jupiterit.com">ï¿½ Jupiter Consulting - JavaScriptMVC Training and Support</a>
	<a class="api_links" href="http://javascriptmvc.com/docs/api.html#&amp;who=api"></a>
</div>
<script type="text/javascript">
	DOCS_SRC_MAP = {
		'funcunit' : 'https://github.com/jupiterjs/funcunit',
		'jquery' : 'https://github.com/jupiterjs/jquerymx',
		'steal' : 'https://github.com/jupiterjs/steal',
		'documentjs' : 'https://github.com/jupiterjs/documentjs',
		mxui : 'https://github.com/jupiterjs/mxui'
	};
	DOCS_LOCATION = "docs/" //adds searchData to this
	JMVCDOC_TIMESTAMP = 265469885
	COMMENTS_LOCATION = 'http://jmvcs3.disqus.com/embed.js';
</script>
<script type="text/javascript" src="../steal/steal.js?documentjs/jmvcdoc">
</script>

<style type="text/css">
  body > iframe { width: 0;} 
  #dsq-content #dsq-form-area .dsq-attach-media-container iframe { height: 13px; padding: 0;}
</style>
	

</body>
</html>